{"version":3,"sources":["../src/app/controllers/member.js"],"names":["connection","require","jwt","bcrypt","userModel","cfg","cMember","potential","req","res","next","email","query","page","undefined","limit","getUserIdByEmail","result","userId","offset","count","acquire","err","con","sql","data","release","status","json","statusCode","message","code","dt","i","length","pp","user_photo","photoProfileUrl","fullName","user_firstname","user_lastname","splitName","trim","split","initialName","charAt","toUpperCase","push","user_id","user_email","user_mobile_number","user_phone_number","user_line","user_whatsapp","user_facebook","user_instagram","user_wechat","user_country","user_address1","user_address2","user_language","success","active","activated","body","invitedBy","affectedRows","updatePoint","ranking","user_point","module","exports"],"mappings":"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","file":"member.js","sourcesContent":["var connection = require('../../../config/db');\n\nvar jwt = require('jsonwebtoken'),\n    bcrypt = require('bcrypt'),\n    userModel = require('../models/user'),\n    cfg = require('../../../config');\n \nfunction cMember() {\n  this.potential = function(req,res,next) {\n      var email = req.query.email;\n      var page = (req.query.page == undefined) ? 1 : req.query.page;\n      var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n\n        var offset = (page - 1) * limit;\n        var count = \" LIMIT \"+offset+\",\"+limit;\n        \n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n            var sql = 'SELECT * FROM users WHERE user_invited_by = \"'+userId+'\" AND status = 2 ORDER BY user_id DESC '+count;\n            con.query(sql, function(err,data){\n              con.release();\n              if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                 \n\n              var dt = [];\n\n              for (var i = 0; i < data.length; i++) {\n                  var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n\n                  var fullName = data[i].user_firstname+' '+data[i].user_lastname;\n\n                  var splitName = fullName.trim().split(\" \");\n\n                  if(splitName.length > 1){\n                    var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n                  }else{\n                    var initialName = splitName[0].charAt(0);\n                  }\n\n                  initialName = initialName.toUpperCase();\n\n                  dt.push({\n                    \"userId\": data[i].user_id,\n                    \"email\": data[i].user_email,\n                    \"firstName\": data[i].user_firstname,\n                    \"lastName\": data[i].user_lastname,\n                    \"initialName\": initialName,\n                    \"photoUrl\": pp,\n                    \"mobileNumber\": data[i].user_mobile_number,\n                    \"phoneNumber\": data[i].user_phone_number,\n                    \"line\": data[i].user_line,\n                    \"whatsapp\": data[i].user_whatsapp,\n                    \"facebook\": data[i].user_facebook,\n                    \"instagram\": data[i].user_instagram,\n                    \"wechat\": data[i].user_wechat,\n                    \"country\": data[i].user_country,\n                    \"address1\": data[i].user_address1,\n                    \"address2\": data[i].user_address2,\n                    \"language\": data[i].user_language\n                  });\n              } \n\n              return res.status(200).json({statusCode:200,success:true,data:dt});\n     \n          });\n        });\n\n      }); \n  };\n\n  this.active = function(req,res,next) {\n      var email = req.query.email;\n      var page = (req.query.page == undefined) ? 1 : req.query.page;\n      var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n\n        var offset = (page - 1) * limit;\n        var count = \" LIMIT \"+offset+\",\"+limit;\n        \n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n            var sql = 'SELECT * FROM users WHERE user_invited_by = \"'+userId+'\" AND status = 1 ORDER BY user_id DESC '+count;\n            con.query(sql, function(err,data){\n              con.release();\n              if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                 \n\n              var dt = [];\n              for (var i = 0; i < data.length; i++) {\n                  var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n                  var fullName = data[i].user_firstname+' '+data[i].user_lastname;\n\n                  var splitName = fullName.trim().split(\" \");\n\n                  if(splitName.length > 1){\n                    var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n                  }else{\n                    var initialName = splitName[0].charAt(0);\n                  }\n\n                  initialName = initialName.toUpperCase();\n\n                  dt.push({\n                    \"userId\": data[i].user_id,\n                    \"email\": data[i].user_email,\n                    \"firstName\": data[i].user_firstname,\n                    \"lastName\": data[i].user_lastname,\n                    \"initialName\": initialName,\n                    \"photoUrl\": pp,\n                    \"mobileNumber\": data[i].user_mobile_number,\n                    \"phoneNumber\": data[i].user_phone_number,\n                    \"line\": data[i].user_line,\n                    \"whatsapp\": data[i].user_whatsapp,\n                    \"facebook\": data[i].user_facebook,\n                    \"instagram\": data[i].user_instagram,\n                    \"wechat\": data[i].user_wechat,\n                    \"country\": data[i].user_country,\n                    \"address1\": data[i].user_address1,\n                    \"address2\": data[i].user_address2,\n                    \"language\": data[i].user_language\n                  });\n              } \n\n              return res.status(200).json({statusCode:200,success:true,data:dt});\n     \n          });\n        });\n\n      }); \n  };\n\n  this.activated = function(req,res,next) {\n     \n    var email = req.body.email,\n        invitedBy = req.body.invitedBy;\n\n    userModel.getUserIdByEmail(invitedBy,res,function(result){\n      var userId = result.userId;\n\n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n        var sql = \"UPDATE users set status = 1 \\\n        ,update_date = NOW() WHERE user_email = '\"+email+\"' AND user_invited_by = '\"+userId+\"' \";\n          \n        con.query(sql, function(err,data){\n            \n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.affectedRows == 0)\n              return res.status(500).json({statusCode:500,message: \"either 'email' or 'invitedBy' wrong\"});\n\n            userModel.updatePoint(userId,3,res,function(result){\n              return res.status(200).json({statusCode:200,success:true});\n            });\n        });\n      \n      });\n    });  \n  };\n\n  this.ranking = function(req,res,next) {\n      var email = req.query.email;\n      var page = (req.query.page == undefined) ? 1 : req.query.page;\n      var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n\n        var offset = (page - 1) * limit;\n        var count = \" LIMIT \"+offset+\",\"+limit;\n        \n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n            var sql = 'SELECT * FROM users WHERE user_invited_by = \"'+userId+'\" AND status <> 0 ORDER BY user_point DESC '+count;\n            con.query(sql, function(err,data){\n              con.release();\n              if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                 \n\n              var dt = [];\n              for (var i = 0; i < data.length; i++) {\n                  var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n                  dt.push({\n                    \"userId\": data[i].user_id,\n                    \"email\": data[i].user_email,\n                    \"firstName\": data[i].user_firstname,\n                    \"lastName\": data[i].user_lastname,\n                    \"photoUrl\": pp,\n                    \"mobileNumber\": data[i].user_mobile_number,\n                    \"phoneNumber\": data[i].user_phone_number,\n                    \"line\": data[i].user_line,\n                    \"whatsapp\": data[i].user_whatsapp,\n                    \"facebook\": data[i].user_facebook,\n                    \"instagram\": data[i].user_instagram,\n                    \"wechat\": data[i].user_wechat,\n                    \"country\": data[i].user_country,\n                    \"address1\": data[i].user_address1,\n                    \"address2\": data[i].user_address2,\n                    \"language\": data[i].user_language,\n                    \"point\": data[i].user_point\n                  });\n              } \n\n              return res.status(200).json({statusCode:200,success:true,data:dt});\n     \n          });\n        });\n\n      }); \n  };\n}\nmodule.exports = new cMember();"]}