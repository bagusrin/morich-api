{"version":3,"sources":["../src/app/controllers/member.js"],"names":["connection","require","jwt","bcrypt","userModel","cfg","cMember","potential","req","res","next","email","query","page","undefined","limit","getUserIdByEmail","result","userId","offset","count","acquire","err","con","sql","data","release","status","json","statusCode","message","code","dt","i","length","pp","user_photo","photoProfileUrl","push","user_id","user_email","user_firstname","user_lastname","user_mobile_number","user_phone_number","user_line","user_whatsapp","user_facebook","user_instagram","user_wechat","user_country","user_address1","user_address2","user_language","success","active","activated","body","invitedBy","affectedRows","updatePoint","ranking","user_point","module","exports"],"mappings":"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","file":"member.js","sourcesContent":["var connection = require('../../../config/db');\n\nvar jwt = require('jsonwebtoken'),\n    bcrypt = require('bcrypt'),\n    userModel = require('../models/user'),\n    cfg = require('../../../config');\n \nfunction cMember() {\n  this.potential = function(req,res,next) {\n      var email = req.query.email;\n      var page = (req.query.page == undefined) ? 1 : req.query.page;\n      var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n\n        var offset = (page - 1) * limit;\n        var count = \" LIMIT \"+offset+\",\"+limit;\n        \n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n            var sql = 'SELECT * FROM users WHERE user_invited_by = \"'+userId+'\" AND status = 2 ORDER BY user_id DESC '+count;\n            con.query(sql, function(err,data){\n              con.release();\n              if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                 \n\n              var dt = [];\n              for (var i = 0; i < data.length; i++) {\n                  var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n                  dt.push({\n                    \"userId\": data[i].user_id,\n                    \"email\": data[i].user_email,\n                    \"firstName\": data[i].user_firstname,\n                    \"lastName\": data[i].user_lastname,\n                    \"photoUrl\": pp,\n                    \"mobileNumber\": data[i].user_mobile_number,\n                    \"phoneNumber\": data[i].user_phone_number,\n                    \"line\": data[i].user_line,\n                    \"whatsapp\": data[i].user_whatsapp,\n                    \"facebook\": data[i].user_facebook,\n                    \"instagram\": data[i].user_instagram,\n                    \"wechat\": data[i].user_wechat,\n                    \"country\": data[i].user_country,\n                    \"address1\": data[i].user_address1,\n                    \"address2\": data[i].user_address2,\n                    \"language\": data[i].user_language\n                  });\n              } \n\n              return res.status(200).json({statusCode:200,success:true,data:dt});\n     \n          });\n        });\n\n      }); \n  };\n\n  this.active = function(req,res,next) {\n      var email = req.query.email;\n      var page = (req.query.page == undefined) ? 1 : req.query.page;\n      var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n\n        var offset = (page - 1) * limit;\n        var count = \" LIMIT \"+offset+\",\"+limit;\n        \n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n            var sql = 'SELECT * FROM users WHERE user_invited_by = \"'+userId+'\" AND status = 1 ORDER BY user_id DESC '+count;\n            con.query(sql, function(err,data){\n              con.release();\n              if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                 \n\n              var dt = [];\n              for (var i = 0; i < data.length; i++) {\n                  var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n                  dt.push({\n                    \"userId\": data[i].user_id,\n                    \"email\": data[i].user_email,\n                    \"firstName\": data[i].user_firstname,\n                    \"lastName\": data[i].user_lastname,\n                    \"photoUrl\": pp,\n                    \"mobileNumber\": data[i].user_mobile_number,\n                    \"phoneNumber\": data[i].user_phone_number,\n                    \"line\": data[i].user_line,\n                    \"whatsapp\": data[i].user_whatsapp,\n                    \"facebook\": data[i].user_facebook,\n                    \"instagram\": data[i].user_instagram,\n                    \"wechat\": data[i].user_wechat,\n                    \"country\": data[i].user_country,\n                    \"address1\": data[i].user_address1,\n                    \"address2\": data[i].user_address2,\n                    \"language\": data[i].user_language\n                  });\n              } \n\n              return res.status(200).json({statusCode:200,success:true,data:dt});\n     \n          });\n        });\n\n      }); \n  };\n\n  this.activated = function(req,res,next) {\n     \n    var email = req.body.email,\n        invitedBy = req.body.invitedBy;\n\n    userModel.getUserIdByEmail(invitedBy,res,function(result){\n      var userId = result.userId;\n\n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n        var sql = \"UPDATE users set status = 1 \\\n        ,update_date = NOW() WHERE user_email = '\"+email+\"' AND user_invited_by = '\"+userId+\"' \";\n          \n        con.query(sql, function(err,data){\n            \n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.affectedRows == 0)\n              return res.status(500).json({statusCode:500,message: \"either 'email' or 'invitedBy' wrong\"});\n\n            userModel.updatePoint(userId,3,res,function(result){\n              return res.status(200).json({statusCode:200,success:true});\n            });\n        });\n      \n      });\n    });  \n  };\n\n  this.ranking = function(req,res,next) {\n      var email = req.query.email;\n      var page = (req.query.page == undefined) ? 1 : req.query.page;\n      var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n\n        var offset = (page - 1) * limit;\n        var count = \" LIMIT \"+offset+\",\"+limit;\n        \n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n            var sql = 'SELECT * FROM users WHERE user_invited_by = \"'+userId+'\" AND status <> 0 ORDER BY user_point DESC '+count;\n            con.query(sql, function(err,data){\n              con.release();\n              if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                 \n\n              var dt = [];\n              for (var i = 0; i < data.length; i++) {\n                  var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n                  dt.push({\n                    \"userId\": data[i].user_id,\n                    \"email\": data[i].user_email,\n                    \"firstName\": data[i].user_firstname,\n                    \"lastName\": data[i].user_lastname,\n                    \"photoUrl\": pp,\n                    \"mobileNumber\": data[i].user_mobile_number,\n                    \"phoneNumber\": data[i].user_phone_number,\n                    \"line\": data[i].user_line,\n                    \"whatsapp\": data[i].user_whatsapp,\n                    \"facebook\": data[i].user_facebook,\n                    \"instagram\": data[i].user_instagram,\n                    \"wechat\": data[i].user_wechat,\n                    \"country\": data[i].user_country,\n                    \"address1\": data[i].user_address1,\n                    \"address2\": data[i].user_address2,\n                    \"language\": data[i].user_language,\n                    \"point\": data[i].user_point\n                  });\n              } \n\n              return res.status(200).json({statusCode:200,success:true,data:dt});\n     \n          });\n        });\n\n      }); \n  };\n}\nmodule.exports = new cMember();"]}