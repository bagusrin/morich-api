{"version":3,"sources":["../src/app/controllers/videoadmin.js"],"names":["connection","require","jwt","bcrypt","userModel","cVideoAdmin","list","req","res","next","page","query","undefined","limit","offset","count","acquire","err","con","sql","data","release","status","json","statusCode","message","code","dt","i","length","push","video_id","video_youtube_id","video_youtube_link","video_youtube_iframe","video_youtube_image","video_title","video_desc","video_position","post_date","success","detail","videoId","params","id","post","youtubeLink","body","title","desc","youtubeId","split","youtubeIframe","youtubeImg","position","console","log","insertId","update","delete","affectedRows","module","exports"],"mappings":"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","file":"videoadmin.js","sourcesContent":["var connection = require('../../../config/db');\n\nvar jwt = require('jsonwebtoken'),\n    bcrypt = require('bcrypt'),\n    userModel = require('../models/user');\n \nfunction cVideoAdmin() {\n \n  this.list = function(req,res,next) {\n\n    var page = (req.query.page == undefined) ? 1 : req.query.page;\n    var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n    \n  \n    var offset = (page - 1) * limit;\n    var count = \" LIMIT \"+offset+\",\"+limit;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n        var sql = \"SELECT * from videos_admin WHERE status = 1 ORDER BY video_id DESC \"+count\n        \n        con.query(sql, function(err,data){\n          con.release();\n          if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n             \n\n          var dt = [];\n          for (var i = 0; i < data.length; i++) {\n              dt.push({\n                \"videoId\": data[i].video_id,\n                \"youtubeId\": data[i].video_youtube_id,\n                \"youtubeLink\": data[i].video_youtube_link,\n                \"youtubeIframe\": data[i].video_youtube_iframe,\n                \"youtubeImg\": data[i].video_youtube_image,\n                \"title\": data[i].video_title,\n                \"description\": data[i].video_desc,\n                \"position\": data[i].video_position,\n                \"postDate\": data[i].post_date\n              });\n          }\n\n          return res.status(200).json({\n                                  statusCode:200,\n                                  success:true,\n                                  data:dt\n                              });\n \n      });\n    });\n  }\n\n  this.detail = function(req,res,next) {\n\n      var videoId = req.params.id;\n    \n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = \"SELECT * from videos_admin WHERE status = 1 AND video_id = '\"+videoId+\"' LIMIT 1\";\n          \n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              var dt = [];\n              dt.push({\n                \"videoId\": data[0].video_id,\n                \"youtubeId\": data[0].video_youtube_id,\n                \"youtubeLink\": data[0].video_youtube_link,\n                \"youtubeIframe\": data[0].video_youtube_iframe,\n                \"youtubeImg\": data[0].video_youtube_image,\n                \"title\": data[0].video_title,\n                \"description\": data[0].video_desc,\n                \"position\": data[0].video_position,\n                \"postDate\": data[0].post_date\n              });\n\n              return res.status(200).json({\n                                      statusCode:200,\n                                      success:true,\n                                      data:dt[0]\n                                  });\n            }\n        });\n      });\n  };\n\n  this.post = function(req,res,next) {\n    var youtubeLink = req.body.youtubeLink;\n    var title = req.body.title;\n    var desc = req.body.desc;\n    var youtubeId = youtubeLink.split(\"v=\")[1];\n    var youtubeIframe = \"https://youtube.com/embed/\"+youtubeId;\n    var youtubeImg = \"https://i.ytimg.com/vi/\"+youtubeId+\"/maxresdefault.jpg\";\n    var position = (req.body.position == undefined) ? 0 : req.body.position;\n    var status = 1;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n        var sql = \"INSERT INTO videos_admin (video_youtube_id, video_youtube_link, video_youtube_iframe \\\n        ,video_youtube_image,video_title,video_desc,video_position,status,post_date) \\\n        VALUES ('\"+youtubeId+\"','\"+youtubeLink+\"','\"+youtubeIframe+\"','\"+youtubeImg+\"','\"+title+\"', '\"+desc+\"','\"+position+\"', '\"+status+\"', NOW())\";\n\n        console.log(sql);\n\n        con.query(sql, function(err,data){\n          con.release();\n          if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n             \n\n          return res.status(200).json({\n                                  statusCode:200,\n                                  success:true,\n                                  data:{\"videoId\":data.insertId}\n                              });\n \n      });\n    });\n     \n  };\n\n  this.update = function(req,res,next) {\n    var videoId = req.body.videoId;\n    var youtubeLink = req.body.youtubeLink;\n    var title = req.body.title;\n    var desc = req.body.desc;\n    var youtubeId = youtubeLink.split(\"v=\")[1];\n    var youtubeIframe = \"https://youtube.com/embed/\"+youtubeId;\n    var youtubeImg = \"https://i.ytimg.com/vi/\"+youtubeId+\"/maxresdefault.jpg\";\n    var position = (req.body.position == undefined) ? 0 : req.body.position;\n    var status = 1;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"UPDATE videos_admin SET video_youtube_id = '\"+youtubeId+\"' \\\n      ,video_youtube_link = '\"+youtubeLink+\"' \\\n      ,video_youtube_iframe = '\"+youtubeIframe+\"',video_youtube_image = '\"+youtubeImg+\"', video_title = '\"+title+\"', video_desc = '\"+desc+\"' \\\n      ,video_position = '\"+position+\"',update_date = NOW() WHERE video_id = '\"+videoId+\"'\";\n\n      con.query(sql, function(err,data){\n        con.release();\n        if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n           \n\n        return res.status(200).json({\n                                statusCode:200,\n                                success:true,\n                                data:{\"videoId\":videoId}\n                            });\n \n      });\n    });\n  };\n\n  this.delete = function(req,res,next) {\n    var videoId = req.body.videoId;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"UPDATE videos_admin SET status = 0 \\\n      ,update_date = NOW() WHERE video_id = '\"+videoId+\"'\";\n\n      //console.log(sql);\n\n        \n\n      con.query(sql, function(err,data){\n        con.release();\n        if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n\n        if(data.affectedRows == 0)\n          return res.status(500).json({statusCode:500,message: \"Failed to delete data. Check your parameter.\"}); \n\n        return res.status(200).json({\n                                statusCode:200,\n                                success:true\n                            });\n \n      });\n    });\n  };\n\n}\nmodule.exports = new cVideoAdmin();"]}