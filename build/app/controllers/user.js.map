{"version":3,"sources":["../src/app/controllers/user.js"],"names":["connection","require","jwt","bcrypt","userModel","generalModel","emailModel","cfg","empty","axios","multer","storage","diskStorage","destination","req","file","cb","filename","mimetype","ext","Date","now","upload","cUser","userRegister","res","next","body","inviterEmail","email","firstName","phoneNumber","status","json","statusCode","message","inviterUsername","lastName","phone","acquire","err","con","checkEmailExist","result","getUserIdByEmail","userId","getReferalCodeByEmail","referalCode","sql","query","data","code","sql2","err2","data2","updatePointByEmail","sendEmailRegister","success","insertId","release","userDetail","params","id","length","dt","pp","user_photo","photoProfileUrl","fullName","user_firstname","user_lastname","splitName","trim","split","initialName","charAt","toUpperCase","statusAccount","push","user_id","user_email","user_username","user_mobile_number","user_phone_number","user_line","user_whatsapp","user_facebook","user_instagram","user_wechat","user_country","user_address1","user_address2","user_language","rank","total_invited","member_joined","member_prospect","inviter_email","userDetailByUsername","username","userGetIdByEmail","userStatisticByEmail","userUpdate","mobileNumber","address1","language","line","whatsapp","facebook","instagram","wechat","country","address2","userUploadPhoto","photoProfile","uploadAction","single","userSubmission","referralEmail","hpWa","city","age","languages","currentOccupation","isExperienceInMobileBusiness","targetMobileBusiness180Days","reason","urgencyLevel","seriousLevel","capitalInvestment","readyToJoin","isAvailableContactToMobile","sendEmailSubmission","userList","i","app","current_occupation","is_experience_mobile_business","target_mobile_business_180_days","urgency_level","serious_level","capital_investment","ready_to_join","is_available_contact_to_mobile","submit_app_date","userID","user_password","user_invited_by","postDate","activated","inviterId","isPassword","point","sqlNew","oriPassword","getRandomStr","password","hashSync","checkUsernameExist","affectedRows","updatePoint","sendTmpPassword","userAdminPost","passwordEncrypt","userIdReferral","sendEmailUserRegisterFromAdmin","userAdminUpdate","oldReferralEmail","oldUsername","checkUsernameCompareExist","userChangePassword","retypePassword","delete","module","exports"],"mappings":"AAAA,IAAIA,aAAaC,QAAQ,oBAAR,CAAjB;;AAEA,IAAIC,MAAMD,QAAQ,cAAR,CAAV;AAAA,IACIE,SAASF,QAAQ,QAAR,CADb;AAAA,IAEIG,YAAYH,QAAQ,gBAAR,CAFhB;AAAA,IAGII,eAAeJ,QAAQ,mBAAR,CAHnB;AAAA,IAIIK,aAAaL,QAAQ,iBAAR,CAJjB;AAAA,IAKIM,MAAMN,QAAQ,iBAAR,CALV;AAAA,IAMIO,QAAQP,QAAQ,UAAR,CANZ;;AAQA,MAAMQ,QAAQR,QAAQ,OAAR,CAAd;AACA,IAAIS,SAAST,QAAQ,QAAR,CAAb;;AAEA,IAAIU,UAAUD,OAAOE,WAAP,CAAmB;AAC7BC,eAAa,CAACC,GAAD,EAAMC,IAAN,EAAYC,EAAZ,KAAmB;AAC9BA,OAAG,IAAH,EAAS,yBAAT;AACD,GAH4B;AAI7BC,YAAU,CAACH,GAAD,EAAMC,IAAN,EAAYC,EAAZ,KAAmB;;AAE3B,YAAOD,KAAKG,QAAZ;AACE,WAAK,YAAL;AACE,YAAIC,MAAM,OAAV;AACF;AACA,WAAK,WAAL;AACE,YAAIA,MAAM,MAAV;AACF;AACA,WAAK,WAAL;AACE,YAAIA,MAAM,MAAV;AACF;AATF;;AAYAH,OAAG,IAAH,EAASI,KAAKC,GAAL,KAAW,EAAX,GAAcF,GAAvB;AACD;AAnB4B,CAAnB,CAAd;;AAsBA,IAAIG,SAASZ,OAAO,EAACC,SAASA,OAAV,EAAP,CAAb;;AAEA,SAASY,KAAT,GAAiB;;AAEf,OAAKC,YAAL,GAAoB,UAASV,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAEzC,QAAIlB,MAAMM,IAAIa,IAAJ,CAASC,YAAf,KAAgCpB,MAAMM,IAAIa,IAAJ,CAASE,KAAf,CAAhC,IAAyDrB,MAAMM,IAAIa,IAAJ,CAASG,SAAf,CAAzD,IAAsFtB,MAAMM,IAAIa,IAAJ,CAASI,WAAf,CAA1F,EACE,OAAON,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;;AAEF,QAAIC,kBAAkBtB,IAAIa,IAAJ,CAASS,eAA/B;AAAA,QACIR,eAAed,IAAIa,IAAJ,CAASC,YAD5B;AAAA,QAEIC,QAAQf,IAAIa,IAAJ,CAASE,KAFrB;AAAA,QAGIC,YAAYhB,IAAIa,IAAJ,CAASG,SAHzB;AAAA,QAIIO,WAAWvB,IAAIa,IAAJ,CAASU,QAJxB;AAAA,QAKIC,QAAQxB,IAAIa,IAAJ,CAASI,WALrB;AAAA,QAMIC,SAAS,CANb;;AAQAhC,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAETpC,gBAAUsC,eAAV,CAA0BD,GAA1B,EAA8BZ,KAA9B,EAAoCJ,GAApC,EAAwC,UAASkB,MAAT,EAAgB;;AAEtDvC,kBAAUwC,gBAAV,CAA2BH,GAA3B,EAA+Bb,YAA/B,EAA4CH,GAA5C,EAAgD,UAASkB,MAAT,EAAgB;;AAE9D,cAAIE,SAASF,OAAOE,MAApB;;AAEAzC,oBAAU0C,qBAAV,CAAgCL,GAAhC,EAAoCb,YAApC,EAAiDH,GAAjD,EAAqD,UAASkB,MAAT,EAAgB;;AAEnE,gBAAII,cAAcJ,OAAOI,WAAzB;;AAEA,gBAAIC,MAAM;gCAAA,GACWnB,KADX,GACiB,MADjB,GACwBC,SADxB,GACkC,KADlC,GACwCO,QADxC,GACiD,MADjD,GACwDC,KADxD,GAC8D,MAD9D,GACqEO,MADrE,GAC4E,MAD5E,GACmFE,WADnF,GAC+F,MAD/F,GACsGf,MADtG,GAC6G,WADvH;;AAIAS,gBAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;;AAE/B,kBAAGV,GAAH,EACE,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEF,kBAAIC,OAAO;;kCAAA,GAEUvB,KAFV,GAEgB,KAFhB,GAEsBD,YAFtB,GAEmC,mBAF9C;;AAIAa,kBAAIQ,KAAJ,CAAUG,IAAV,EAAgB,UAASC,IAAT,EAAcC,KAAd,EAAoB;AAClC,oBAAGD,IAAH,EACE,OAAO5B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASkB,KAAKF,IAA9B,EAArB,CAAP;;AAEF/C,0BAAUmD,kBAAV,CAA6Bd,GAA7B,EAAiCb,YAAjC,EAA8C,CAA9C,EAAgDH,GAAhD,EAAoD,UAASkB,MAAT,EAAgB;AAClErC,6BAAWkD,iBAAX,CAA6B3B,KAA7B,EAAmCC,SAAnC,EAA6CM,eAA7C;AACA,yBAAOX,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASA,KAAKQ,QAAf,EAAlC,EAArB,CAAP;AACD,iBAHD;AAID,eARD;AASD,aAlBD;AAmBD,WA3BD;AA4BD,SAhCD;AAiCD,OAnCD;;AAqCAjB,UAAIkB,OAAJ;AAED,KA1CD;AA2CD,GAxDD;;AA2DA,OAAKC,UAAL,GAAkB,UAAS9C,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;AACtC1B,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AACjC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAEP,UAAIQ,MAAM;;8CAAA,GAE2BlC,IAAI+C,MAAJ,CAAWC,EAFtC,GAEyC,UAFnD;;AAIA;AACArB,UAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;AAC/BT,YAAIkB,OAAJ;AACA,YAAGnB,GAAH,EACI,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEJ,YAAGD,KAAKa,MAAL,GAAc,CAAjB,EAAmB;AACjBtC,cAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,gBAAzB,EAArB;AACD,SAFD,MAEK;;AAEH,cAAI6B,KAAK,EAAT;AACA,cAAIC,KAAMf,KAAK,CAAL,EAAQgB,UAAT,GAAuB3D,IAAI4D,eAAJ,GAAoB,EAApB,GAAuBjB,KAAK,CAAL,EAAQgB,UAAtD,GAAmE,IAA5E;;AAEA,cAAIE,WAAWlB,KAAK,CAAL,EAAQmB,cAAR,GAAuB,GAAvB,GAA2BnB,KAAK,CAAL,EAAQoB,aAAlD;;AAEA,cAAIC,YAAYH,SAASI,IAAT,GAAgBC,KAAhB,CAAsB,GAAtB,CAAhB;;AAEA,cAAGF,UAAUR,MAAV,GAAmB,CAAtB,EAAwB;AACtB,gBAAIW,cAAcH,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,IAAuB,EAAvB,GAA0BJ,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,CAA5C;AACD,WAFD,MAEK;AACH,gBAAID,cAAcH,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,CAAlB;AACD;;AAEDD,wBAAcA,YAAYE,WAAZ,EAAd;;AAEA,cAAIC,gBAAgB,EAApB;;AAEA,cAAG3B,KAAK,CAAL,EAAQlB,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,UAAhB;AACD;;AAED,cAAG3B,KAAK,CAAL,EAAQlB,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,QAAhB;AACD;;AAED,cAAG3B,KAAK,CAAL,EAAQlB,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,SAAhB;AACD;;AAEDb,aAAGc,IAAH,CAAQ;AACN,sBAAU5B,KAAK,CAAL,EAAQ6B,OADZ;AAEN,qBAAS7B,KAAK,CAAL,EAAQ8B,UAFX;AAGN,wBAAY9B,KAAK,CAAL,EAAQ+B,aAHd;AAIN,yBAAa/B,KAAK,CAAL,EAAQmB,cAJf;AAKN,wBAAYnB,KAAK,CAAL,EAAQoB,aALd;AAMN,2BAAeI,WANT;AAON,wBAAYT,EAPN;AAQN,4BAAgBf,KAAK,CAAL,EAAQgC,kBARlB;AASN,2BAAehC,KAAK,CAAL,EAAQiC,iBATjB;AAUN,oBAAQjC,KAAK,CAAL,EAAQkC,SAVV;AAWN,wBAAYlC,KAAK,CAAL,EAAQmC,aAXd;AAYN,wBAAYnC,KAAK,CAAL,EAAQoC,aAZd;AAaN,yBAAapC,KAAK,CAAL,EAAQqC,cAbf;AAcN,sBAAUrC,KAAK,CAAL,EAAQsC,WAdZ;AAeN,uBAAWtC,KAAK,CAAL,EAAQuC,YAfb;AAgBN,wBAAYvC,KAAK,CAAL,EAAQwC,aAhBd;AAiBN,wBAAYxC,KAAK,CAAL,EAAQyC,aAjBd;AAkBN,wBAAYzC,KAAK,CAAL,EAAQ0C,aAlBd;AAmBN,uBAAW1C,KAAK,CAAL,EAAQ2C,IAnBb;AAoBN,mBAAO,iCAA+B3C,KAAK,CAAL,EAAQ+B,aApBxC;AAqBN,4BAAgB/B,KAAK,CAAL,EAAQ4C,aArBlB;AAsBN,4BAAgB5C,KAAK,CAAL,EAAQ6C,aAtBlB;AAuBN,8BAAkB7C,KAAK,CAAL,EAAQ8C,eAvBpB;AAwBN,4BAAgBxF,MAAM0C,KAAK,CAAL,EAAQ+C,aAAd,IAA+B,MAA/B,GAAwC/C,KAAK,CAAL,EAAQ+C,aAxB1D;AAyBN,6BAAiBpB;AAzBX,WAAR;;AA4BA,iBAAOpD,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAKc,GAAG,CAAH,CAAlC,EAArB,CAAP;AACD;AACJ,OApEC;AAqEJ,KA7ED;AA8EF,GA/ED;;AAiFA,OAAKkC,oBAAL,GAA4B,UAASpF,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;AAChD1B,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AACjC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAEP,UAAIQ,MAAM;;qDAAA,GAEkClC,IAAI+C,MAAJ,CAAWsC,QAF7C,GAEsD,WAFhE;;AAIA;AACA1D,UAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;AAC/BT,YAAIkB,OAAJ;AACA,YAAGnB,GAAH,EACI,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEJ,YAAGD,KAAKa,MAAL,GAAc,CAAjB,EAAmB;AACjBtC,cAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,gBAAzB,EAArB;AACD,SAFD,MAEK;;AAEH,cAAI6B,KAAK,EAAT;AACA,cAAIC,KAAMf,KAAK,CAAL,EAAQgB,UAAT,GAAuB3D,IAAI4D,eAAJ,GAAoB,EAApB,GAAuBjB,KAAK,CAAL,EAAQgB,UAAtD,GAAmE,IAA5E;;AAEA,cAAIE,WAAWlB,KAAK,CAAL,EAAQmB,cAAR,GAAuB,GAAvB,GAA2BnB,KAAK,CAAL,EAAQoB,aAAlD;;AAEA,cAAIC,YAAYH,SAASI,IAAT,GAAgBC,KAAhB,CAAsB,GAAtB,CAAhB;;AAEA,cAAGF,UAAUR,MAAV,GAAmB,CAAtB,EAAwB;AACtB,gBAAIW,cAAcH,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,IAAuB,EAAvB,GAA0BJ,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,CAA5C;AACD,WAFD,MAEK;AACH,gBAAID,cAAcH,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,CAAlB;AACD;;AAEDD,wBAAcA,YAAYE,WAAZ,EAAd;;AAEA,cAAIC,gBAAgB,EAApB;;AAEA,cAAG3B,KAAK,CAAL,EAAQlB,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,UAAhB;AACD;;AAED,cAAG3B,KAAK,CAAL,EAAQlB,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,QAAhB;AACD;;AAED,cAAG3B,KAAK,CAAL,EAAQlB,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,SAAhB;AACD;;AAEDb,aAAGc,IAAH,CAAQ;AACN,sBAAU5B,KAAK,CAAL,EAAQ6B,OADZ;AAEN,qBAAS7B,KAAK,CAAL,EAAQ8B,UAFX;AAGN,wBAAY9B,KAAK,CAAL,EAAQ+B,aAHd;AAIN,yBAAa/B,KAAK,CAAL,EAAQmB,cAJf;AAKN,wBAAYnB,KAAK,CAAL,EAAQoB,aALd;AAMN,2BAAeI,WANT;AAON,wBAAYT,EAPN;AAQN,4BAAgBf,KAAK,CAAL,EAAQgC,kBARlB;AASN,2BAAehC,KAAK,CAAL,EAAQiC,iBATjB;AAUN,oBAAQjC,KAAK,CAAL,EAAQkC,SAVV;AAWN,wBAAYlC,KAAK,CAAL,EAAQmC,aAXd;AAYN,wBAAYnC,KAAK,CAAL,EAAQoC,aAZd;AAaN,yBAAapC,KAAK,CAAL,EAAQqC,cAbf;AAcN,sBAAUrC,KAAK,CAAL,EAAQsC,WAdZ;AAeN,uBAAWtC,KAAK,CAAL,EAAQuC,YAfb;AAgBN,wBAAYvC,KAAK,CAAL,EAAQwC,aAhBd;AAiBN,wBAAYxC,KAAK,CAAL,EAAQyC,aAjBd;AAkBN,wBAAYzC,KAAK,CAAL,EAAQ0C,aAlBd;AAmBN,uBAAW1C,KAAK,CAAL,EAAQ2C,IAnBb;AAoBN,mBAAO,iCAA+B3C,KAAK,CAAL,EAAQ+B,aApBxC;AAqBN,4BAAgB/B,KAAK,CAAL,EAAQ4C,aArBlB;AAsBN,4BAAgB5C,KAAK,CAAL,EAAQ6C,aAtBlB;AAuBN,8BAAkB7C,KAAK,CAAL,EAAQ8C,eAvBpB;AAwBN,4BAAgBxF,MAAM0C,KAAK,CAAL,EAAQ+C,aAAd,IAA+B,MAA/B,GAAwC/C,KAAK,CAAL,EAAQ+C,aAxB1D;AAyBN,6BAAiBpB;AAzBX,WAAR;;AA4BA,iBAAOpD,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAKc,GAAG,CAAH,CAAlC,EAArB,CAAP;AACD;AACJ,OApEC;AAqEJ,KA7ED;AA8EF,GA/ED;;AAiFA,OAAKoC,gBAAL,GAAwB,UAAStF,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;AAC3C,QAAIG,QAAQf,IAAImC,KAAJ,CAAUpB,KAAtB;;AAEA7B,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAETpC,gBAAUwC,gBAAV,CAA2BH,GAA3B,EAA+BZ,KAA/B,EAAqCJ,GAArC,EAAyC,UAASkB,MAAT,EAAgB;;AAEvD,YAAIE,SAASF,OAAOE,MAApB;AACA,eAAOpB,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAlC,EAArB,CAAP;AAED,OALD;AAMAJ,UAAIkB,OAAJ;AACD,KAVD;AAWH,GAdD;;AAgBA,OAAK0C,oBAAL,GAA4B,UAASvF,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;AACjD,QAAIG,QAAQf,IAAImC,KAAJ,CAAUpB,KAAtB;;AAEA,QAAGrB,MAAMqB,KAAN,CAAH,EACE,OAAOJ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,6BAAzB,EAArB,CAAP;;AAEFnC,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;AACPC,UAAIQ,KAAJ,CAAU;;gDAAA,GAE+BnC,IAAImC,KAAJ,CAAUpB,KAFzC,GAE+C,WAFzD,EAEsE,UAASW,GAAT,EAAaU,IAAb,EAAkB;AACtFT,YAAIkB,OAAJ;AACA,YAAGnB,GAAH,EACI,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEJ,YAAGD,KAAKa,MAAL,GAAc,CAAjB,EAAmB;AACjBtC,cAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,gBAAzB,EAArB;AACD,SAFD,MAEK;;AAEH,cAAI6B,KAAK,EAAT;;AAEAA,aAAGc,IAAH,CAAQ;AACN,uBAAW5B,KAAK,CAAL,EAAQ2C,IADb;AAEN,4BAAgB3C,KAAK,CAAL,EAAQ4C,aAFlB;AAGN,4BAAgB5C,KAAK,CAAL,EAAQ6C,aAHlB;AAIN,8BAAkB7C,KAAK,CAAL,EAAQ8C;AAJpB,WAAR;;AAOA,iBAAOvE,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAKc,GAAG,CAAH,CAAlC,EAArB,CAAP;AACD;AACJ,OAtBC;AAwBH,KA1BD;AA2BD,GAjCD;;AAmCA,OAAKsC,UAAL,GAAkB,UAASxF,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAEvC,QAAIlB,MAAMM,IAAIa,IAAJ,CAASG,SAAf,KAA6BtB,MAAMM,IAAIa,IAAJ,CAASE,KAAf,CAA7B,IAAsDrB,MAAMM,IAAIa,IAAJ,CAAS4E,YAAf,CAAtD,IAAsF/F,MAAMM,IAAIa,IAAJ,CAAS6E,QAAf,CAA1F,EACE,OAAO/E,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;;AAEF,QAAIL,YAAYhB,IAAIa,IAAJ,CAASG,SAAzB;AAAA,QACIO,WAAWvB,IAAIa,IAAJ,CAASU,QADxB;AAAA,QAEIoE,WAAW3F,IAAIa,IAAJ,CAAS8E,QAFxB;AAAA,QAGI5E,QAAQf,IAAIa,IAAJ,CAASE,KAHrB;AAAA,QAII0E,eAAezF,IAAIa,IAAJ,CAAS4E,YAJ5B;AAAA,QAKIxE,cAAcjB,IAAIa,IAAJ,CAASI,WAL3B;AAAA,QAMI2E,OAAO5F,IAAIa,IAAJ,CAAS+E,IANpB;AAAA,QAOIC,WAAW7F,IAAIa,IAAJ,CAASgF,QAPxB;AAAA,QAQIC,WAAW9F,IAAIa,IAAJ,CAASiF,QARxB;AAAA,QASIC,YAAY/F,IAAIa,IAAJ,CAASkF,SATzB;AAAA,QAUIC,SAAShG,IAAIa,IAAJ,CAASmF,MAVtB;AAAA,QAWIC,UAAUjG,IAAIa,IAAJ,CAASoF,OAXvB;AAAA,QAYIP,WAAW1F,IAAIa,IAAJ,CAAS6E,QAZxB;AAAA,QAaIQ,WAAWlG,IAAIa,IAAJ,CAASqF,QAbxB;;AAeAhH,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAET,UAAIQ,MAAM,wCAAsClB,SAAtC,GAAgD,sBAAhD,GAAuEO,QAAvE,GAAgF;yBAAhF,GACUoE,QADV,GACmB,2BADnB,GAC+CF,YAD/C,GAC4D,0BAD5D,GACuFxE,WADvF,GACmG;qBADnG,GAEM2E,IAFN,GAEW;yBAFX,GAGUC,QAHV,GAGmB;yBAHnB,GAIUC,QAJV,GAImB;0BAJnB,GAKWC,SALX,GAKqB;uBALrB,GAMQC,MANR,GAMe;wBANf,GAOSC,OAPT,GAOiB;yBAPjB,GAQUP,QARV,GAQmB;yBARnB,GASUQ,QATV,GASmB;gDATnB,GAUiCnF,KAVjC,GAUuC,GAVjD;;AAYAY,UAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;;AAE7B,YAAGV,GAAH,EACE,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEF/C,kBAAUwC,gBAAV,CAA2BH,GAA3B,EAA+BZ,KAA/B,EAAqCJ,GAArC,EAAyC,UAASkB,MAAT,EAAgB;AACvD,cAAIE,SAASF,OAAOE,MAApB;AACA,iBAAOpB,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAlC,EAArB,CAAP;AACD,SAHD;AAIH,OATD;;AAWAJ,UAAIkB,OAAJ;AAED,KA5BD;AA8BD,GAlDD;;AAoDA,OAAKsD,eAAL,GAAuB,UAASnG,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAE5C,QAAIlB,MAAMM,IAAIa,IAAJ,CAASE,KAAf,CAAJ,EACE,OAAOJ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;;AAEF,QAAI+E,eAAepG,IAAIC,IAAJ,CAASE,QAA5B;AACA,QAAIY,QAAQf,IAAIa,IAAJ,CAASE,KAArB;;AAEA7B,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAETpC,gBAAUwC,gBAAV,CAA2BH,GAA3B,EAA+BZ,KAA/B,EAAqCJ,GAArC,EAAyC,UAASkB,MAAT,EAAgB;;AAEvD,YAAIE,SAASF,OAAOE,MAApB;;AAEA,YAAIG,MAAM,oCAAkCkE,YAAlC,GAA+C;8CAA/C,GAC6BrE,MAD7B,GACoC,GAD9C;;AAGAJ,YAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;;AAE/B,cAAGV,GAAH,EACE,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEF,iBAAO1B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAiB,iBAAgBqE,YAAjC,EAAlC,EAArB,CAAP;AACD,SAND;AAOD,OAdD;;AAgBAzE,UAAIkB,OAAJ;AAED,KArBD;AAuBD,GA/BD;;AAiCA,OAAKwD,YAAL,GAAoB7F,OAAO8F,MAAP,CAAc,OAAd,CAApB;;AAEA,OAAKC,cAAL,GAAsB,UAASvG,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAE3C,QAAI4F,gBAAgBxG,IAAIa,IAAJ,CAAS2F,aAA7B;AAAA,QACIlD,WAAWtD,IAAIa,IAAJ,CAASyC,QADxB;AAAA,QAEIvC,QAAQf,IAAIa,IAAJ,CAASE,KAFrB;AAAA,QAGI0F,OAAOzG,IAAIa,IAAJ,CAAS4F,IAHpB;AAAA,QAIIC,OAAO1G,IAAIa,IAAJ,CAAS6F,IAJpB;AAAA,QAKIC,MAAM3G,IAAIa,IAAJ,CAAS8F,GALnB;AAAA,QAMIC,YAAY5G,IAAIa,IAAJ,CAAS+F,SANzB;AAAA,QAOIC,oBAAoB7G,IAAIa,IAAJ,CAASgG,iBAPjC;AAAA,QAQIC,+BAA+B9G,IAAIa,IAAJ,CAASiG,4BAR5C;AAAA,QASIC,8BAA8B/G,IAAIa,IAAJ,CAASkG,2BAT3C;AAAA,QAUIC,SAAShH,IAAIa,IAAJ,CAASmG,MAVtB;AAAA,QAWIC,eAAejH,IAAIa,IAAJ,CAASoG,YAX5B;AAAA,QAYIC,eAAelH,IAAIa,IAAJ,CAASqG,YAZ5B;AAAA,QAaIC,oBAAoBnH,IAAIa,IAAJ,CAASsG,iBAbjC;AAAA,QAcIC,cAAcpH,IAAIa,IAAJ,CAASuG,WAd3B;AAAA,QAeIC,6BAA6BrH,IAAIa,IAAJ,CAASwG,0BAf1C;;AAiBA,QAAI3H,MAAM8G,aAAN,KAAwB9G,MAAM4D,QAAN,CAAxB,IAA2C5D,MAAMqB,KAAN,CAA3C,IAA2DrB,MAAM+G,IAAN,CAA3D,IACC/G,MAAMgH,IAAN,CADD,IACgBhH,MAAMiH,GAAN,CADhB,IAC8BjH,MAAMkH,SAAN,CAD9B,IACkDlH,MAAMmH,iBAAN,CADlD,IAEFnH,MAAMoH,4BAAN,CAFE,IAEqCpH,MAAMqH,2BAAN,CAFrC,IAE2ErH,MAAMsH,MAAN,CAF3E,IAE4FtH,MAAMuH,YAAN,CAF5F,IAGFvH,MAAMwH,YAAN,CAHE,IAGqBxH,MAAMyH,iBAAN,CAHrB,IAGiDzH,MAAM0H,WAAN,CAHjD,IAGuE1H,MAAM2H,0BAAN,CAH3E,EAG8G;AAC5G,aAAO1G,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;AACD;;AAED7B,eAAW8H,mBAAX,CAA+BtH,IAAIa,IAAnC;AACA,WAAOF,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAArB,CAAP;AAED,GA7BD;;AAgCA,OAAK4E,QAAL,GAAgB,UAASvH,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;AACpC1B,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AACjC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAEP,UAAIQ,MAAM;;;;;;4FAAV;;AAQA;AACAP,UAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;AAC/BT,YAAIkB,OAAJ;AACA,YAAGnB,GAAH,EACI,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEJ,YAAIa,KAAK,EAAT;AACA,aAAK,IAAIsE,IAAI,CAAb,EAAgBA,IAAIpF,KAAKa,MAAzB,EAAiCuE,GAAjC,EAAsC;AACpC,cAAIrE,KAAMf,KAAKoF,CAAL,EAAQpE,UAAT,GAAuB3D,IAAI4D,eAAJ,GAAoB,EAApB,GAAuBjB,KAAKoF,CAAL,EAAQpE,UAAtD,GAAmE,IAA5E;;AAEA,cAAIE,WAAWlB,KAAKoF,CAAL,EAAQjE,cAAR,GAAuB,GAAvB,GAA2BnB,KAAKoF,CAAL,EAAQhE,aAAlD;;AAEA,cAAIC,YAAYH,SAASI,IAAT,GAAgBC,KAAhB,CAAsB,GAAtB,CAAhB;;AAEA,cAAGF,UAAUR,MAAV,GAAmB,CAAtB,EAAwB;AACtB,gBAAIW,cAAcH,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,IAAuB,EAAvB,GAA0BJ,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,CAA5C;AACD,WAFD,MAEK;AACH,gBAAID,cAAcH,UAAU,CAAV,EAAaI,MAAb,CAAoB,CAApB,CAAlB;AACD;;AAEDD,wBAAcA,YAAYE,WAAZ,EAAd;;AAEA,cAAIC,gBAAgB,EAApB;;AAEA,cAAG3B,KAAKoF,CAAL,EAAQtG,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,UAAhB;AACD;;AAED,cAAG3B,KAAKoF,CAAL,EAAQtG,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,QAAhB;AACD;;AAED,cAAG3B,KAAKoF,CAAL,EAAQtG,MAAR,IAAkB,CAArB,EAAuB;AACrB6C,4BAAgB,SAAhB;AACD;;AAED,cAAI0D,MAAM,EAAV;AACA,cAAG,CAAC/H,MAAM0C,KAAKoF,CAAL,EAAQvD,OAAd,CAAJ,EAA2B;AACzBwD,kBAAM;AACJ,sBAAQrF,KAAKoF,CAAL,EAAQd,IADZ;AAEJ,qBAAOtE,KAAKoF,CAAL,EAAQb,GAFX;AAGJ,4BAAcvE,KAAKoF,CAAL,EAAQE,kBAHlB;AAIJ,8CAAgCtF,KAAKoF,CAAL,EAAQG,6BAJpC;AAKJ,6CAA+BvF,KAAKoF,CAAL,EAAQI,+BALnC;AAMJ,wBAAUxF,KAAKoF,CAAL,EAAQR,MANd;AAOJ,8BAAgB5E,KAAKoF,CAAL,EAAQK,aAPpB;AAQJ,8BAAgBzF,KAAKoF,CAAL,EAAQM,aARpB;AASJ,mCAAqB1F,KAAKoF,CAAL,EAAQO,kBATzB;AAUJ,6BAAe3F,KAAKoF,CAAL,EAAQQ,aAVnB;AAWJ,4CAA8B5F,KAAKoF,CAAL,EAAQS,8BAXlC;AAYJ,+BAAiB7F,KAAKoF,CAAL,EAAQU;AAZrB,aAAN;AAcD;;AAEDhF,aAAGc,IAAH,CAAQ;AACN,sBAAU5B,KAAKoF,CAAL,EAAQW,MADZ;AAEN,wBAAYzI,MAAM0C,KAAKoF,CAAL,EAAQY,aAAd,IAA+B,OAA/B,GAAyC,MAF/C;AAGN,qBAAShG,KAAKoF,CAAL,EAAQtD,UAHX;AAIN,wBAAY9B,KAAKoF,CAAL,EAAQrD,aAJd;AAKN,yBAAa/B,KAAKoF,CAAL,EAAQjE,cALf;AAMN,wBAAYnB,KAAKoF,CAAL,EAAQhE,aANd;AAON,2BAAeI,WAPT;AAQN,wBAAYT,EARN;AASN,4BAAgBf,KAAKoF,CAAL,EAAQpD,kBATlB;AAUN,2BAAehC,KAAKoF,CAAL,EAAQnD,iBAVjB;AAWN,oBAAQjC,KAAKoF,CAAL,EAAQlD,SAXV;AAYN,wBAAYlC,KAAKoF,CAAL,EAAQjD,aAZd;AAaN,wBAAYnC,KAAKoF,CAAL,EAAQhD,aAbd;AAcN,yBAAapC,KAAKoF,CAAL,EAAQ/C,cAdf;AAeN,sBAAUrC,KAAKoF,CAAL,EAAQ9C,WAfZ;AAgBN,uBAAWtC,KAAKoF,CAAL,EAAQ7C,YAhBb;AAiBN,wBAAYvC,KAAKoF,CAAL,EAAQ5C,aAjBd;AAkBN,wBAAYxC,KAAKoF,CAAL,EAAQ3C,aAlBd;AAmBN,wBAAYzC,KAAKoF,CAAL,EAAQ1C,aAnBd;AAoBN,uBAAW1C,KAAKoF,CAAL,EAAQzC,IApBb;AAqBN,mBAAO,iCAA+B3C,KAAKoF,CAAL,EAAQrD,aArBxC;AAsBN,4BAAgB/B,KAAKoF,CAAL,EAAQxC,aAtBlB;AAuBN,4BAAgB5C,KAAKoF,CAAL,EAAQvC,aAvBlB;AAwBN,8BAAkB7C,KAAKoF,CAAL,EAAQtC,eAxBpB;AAyBN,4BAAgB9C,KAAKoF,CAAL,EAAQrC,aAzBlB;AA0BN,6BAAiBpB,aA1BX;AA2BN,yBAAa3B,KAAKoF,CAAL,EAAQa,eA3Bf;AA4BN,wBAAYjG,KAAKoF,CAAL,EAAQc,QA5Bd;AA6BN,oBAAQlG,KAAKoF,CAAL,EAAQd,IA7BV;AA8BN,mBAAOtE,KAAKoF,CAAL,EAAQb,GA9BT;AA+BN,0BAAcvE,KAAKoF,CAAL,EAAQE,kBA/BhB;AAgCN,4CAAgCtF,KAAKoF,CAAL,EAAQG,6BAhClC;AAiCN,2CAA+BvF,KAAKoF,CAAL,EAAQI,+BAjCjC;AAkCN,sBAAUxF,KAAKoF,CAAL,EAAQR,MAlCZ;AAmCN,4BAAgB5E,KAAKoF,CAAL,EAAQK,aAnClB;AAoCN,4BAAgBzF,KAAKoF,CAAL,EAAQM,aApClB;AAqCN,iCAAqB1F,KAAKoF,CAAL,EAAQO,kBArCvB;AAsCN,2BAAe3F,KAAKoF,CAAL,EAAQQ,aAtCjB;AAuCN,0CAA8B5F,KAAKoF,CAAL,EAAQS,8BAvChC;AAwCN,6BAAiB7F,KAAKoF,CAAL,EAAQU;AAxCnB,WAAR;AA0CD;AACD,eAAOvH,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAKc,EAAlC,EAArB,CAAP;AACD,OAjGD;AAkGH,KA9GF;AA+GF,GAhHD;;AAkHA,OAAKqF,SAAL,GAAiB,UAASvI,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAEtC,QAAIoC,KAAKhD,IAAIa,IAAJ,CAASkB,MAAlB;AACA,QAAIhB,QAAQf,IAAIa,IAAJ,CAASE,KAArB;AACA,QAAIsE,WAAWrF,IAAIa,IAAJ,CAASwE,QAAxB;AACA,QAAImD,YAAYxI,IAAIa,IAAJ,CAAS2H,SAAzB;AACA,QAAIC,aAAazI,IAAIa,IAAJ,CAAS4H,UAA1B;AACA,QAAIvH,SAASlB,IAAIa,IAAJ,CAASK,MAAtB;;AAEA,QAAIwH,QAAQ,EAAZ;;AAEA,QAAG1I,IAAIa,IAAJ,CAASK,MAAT,IAAmB,GAAtB,EAA0B;AACxBwH,cAAQ,CAAR;AACD,KAFD,MAEK;AACHA,cAAQ,CAAR;AACD;;AAGD,QAAIC,SAAS,gCAA8B3I,IAAIa,IAAJ,CAASK,MAAvC,GAA8C,sBAA9C,GAAqEmE,QAArE,GAA8E;8CAA9E,GAC8BrC,EAD9B,GACiC,IAD9C;AAEA,QAAI4F,cAAcrJ,aAAasJ,YAAb,EAAlB;;AAEA,QAAGJ,cAAc,OAAjB,EAAyB;AACvB,UAAIK,WAAWzJ,OAAO0J,QAAP,CAAgBH,WAAhB,EAA6B,EAA7B,CAAf;AACA,UAAID,SAAS,gCAA8B3I,IAAIa,IAAJ,CAASK,MAAvC,GAA8C,sBAA9C,GAAqEmE,QAArE,GAA8E;yBAA9E,GACOyD,QADP,GACgB,0CADhB,GAC2D9F,EAD3D,GAC8D,IAD3E;AAED;;AAGD9D,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAETpC,gBAAU0J,kBAAV,CAA6BrH,GAA7B,EAAiC0D,QAAjC,EAA0C1E,GAA1C,EAA8C,UAASkB,MAAT,EAAgB;;AAE5D,YAAIK,MAAMyG,MAAV;;AAEA;;AAEAhH,YAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;AAC7B,cAAGV,GAAH,EACE,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEF,cAAGD,KAAK6G,YAAL,IAAqB,CAAxB,EACE,OAAOtI,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,qCAAzB,EAArB,CAAP;;AAEF/B,oBAAU4J,WAAV,CAAsBvH,GAAtB,EAA0B6G,SAA1B,EAAoCE,KAApC,EAA0C/H,GAA1C,EAA8C,UAASkB,MAAT,EAAgB;;AAE5D,gBAAG4G,cAAc,OAAjB,EAAyB;AACvBjJ,yBAAW2J,eAAX,CAA2BpI,KAA3B,EAAiC6H,WAAjC,EAA6C1H,MAA7C,EAAoDmE,QAApD;AACD;;AAED,mBAAO1E,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAArB,CAAP;AACD,WAPD;AAQH,SAfD;AAgBD,OAtBD;AAuBAhB,UAAIkB,OAAJ;AACD,KA3BD;AA4BD,GAzDD;;AA2DA,OAAKuG,aAAL,GAAqB,UAASpJ,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAE1C;;AAEA,QAAIlB,MAAMM,IAAIa,IAAJ,CAASG,SAAf,KAA6BtB,MAAMM,IAAIa,IAAJ,CAAS4E,YAAf,CAA7B,IAA6D/F,MAAMM,IAAIa,IAAJ,CAASE,KAAf,CAAjE,EACE,OAAOJ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;;AAEF,QAAIN,QAAQf,IAAIa,IAAJ,CAASE,KAArB;AAAA,QACIsE,WAAWrF,IAAIa,IAAJ,CAASwE,QADxB;AAAA,QAEIrE,YAAYhB,IAAIa,IAAJ,CAASG,SAFzB;AAAA,QAGIO,WAAWvB,IAAIa,IAAJ,CAASU,QAHxB;AAAA,QAIIkE,eAAezF,IAAIa,IAAJ,CAAS4E,YAJ5B;AAAA,QAKIe,gBAAgBxG,IAAIa,IAAJ,CAAS2F,aAL7B;AAAA,QAMIzC,gBAAgB/D,IAAIa,IAAJ,CAASK,MAN7B;AAAA,QAOI4H,WAAWvJ,aAAasJ,YAAb,EAPf;AAAA,QAQIQ,kBAAkBhK,OAAO0J,QAAP,CAAgBD,QAAhB,EAA0B,EAA1B,CARtB;;AAUA,QAAGpJ,MAAM8G,aAAN,CAAH,EAAwB;AACtBA,sBAAgB,MAAhB;AACD;;AAED,QAAIkC,QAAQ,EAAZ;;AAEA,QAAG3E,iBAAiB,GAApB,EAAwB;AACtB2E,cAAQ,CAAR;AACD,KAFD,MAEK;AACHA,cAAQ,CAAR;AACD;;AAEDxJ,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAETpC,gBAAUsC,eAAV,CAA0BD,GAA1B,EAA8BZ,KAA9B,EAAoCJ,GAApC,EAAwC,UAASkB,MAAT,EAAgB;;AAEtDvC,kBAAU0J,kBAAV,CAA6BrH,GAA7B,EAAiC0D,QAAjC,EAA0C1E,GAA1C,EAA8C,UAASkB,MAAT,EAAgB;;AAE5DvC,oBAAUwC,gBAAV,CAA2BH,GAA3B,EAA+B6E,aAA/B,EAA6C7F,GAA7C,EAAiD,UAASkB,MAAT,EAAgB;;AAE/D,gBAAIyH,iBAAiBzH,OAAOE,MAA5B;AACA;;AAEA,gBAAIG,MAAM;oCAAA,GACenB,KADf,GACqB,MADrB,GAC4BsI,eAD5B,GAC4C,MAD5C,GACmDrI,SADnD,GAC6D,MAD7D,GACoEO,QADpE,GAC6E,MAD7E,GACoFkE,YADpF,GACiG,KADjG,GACuG6D,cADvG,GACsH,UADhI;;AAGA3H,gBAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;;AAE7B,kBAAGV,GAAH,EACE,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAGF,kBAAIiB,WAAWtC,YAAU,GAAV,GAAcO,QAA7B;;AAEA,kBAAIQ,SAASK,KAAKQ,QAAlB,CAA2B;;AAE3B,kBAAIN,OAAO,uCAAqC+C,QAArC,GAA8C,eAA9C,GAA8DtB,aAA9D,GAA4E,6CAA5E,GAA0HhD,KAA1H,GAAgI,GAA3I;;AAEAY,kBAAIQ,KAAJ,CAAUG,IAAV,EAAgB,UAASC,IAAT,EAAcC,KAAd,EAAoB;AAClC,oBAAGD,IAAH,EACE,OAAO5B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASkB,KAAKF,IAA9B,EAArB,CAAP;;AAEF,oBAAGmE,iBAAiB,MAApB,EAA2B;AACzB,sBAAIlE,OAAO;;sCAAA,GAEQvB,KAFR,GAEc,KAFd,GAEoByF,aAFpB,GAEkC,mBAF7C;;AAIA7E,sBAAIQ,KAAJ,CAAUG,IAAV,EAAgB,UAASC,IAAT,EAAcC,KAAd,EAAoB;AAClC,wBAAGD,IAAH,EACE,OAAO5B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASkB,KAAKF,IAA9B,EAArB,CAAP;;AAEA/C,8BAAUmD,kBAAV,CAA6Bd,GAA7B,EAAiC6E,aAAjC,EAA+CkC,KAA/C,EAAqD/H,GAArD,EAAyD,UAASkB,MAAT,EAAgB;AACvErC,iCAAW+J,8BAAX,CAA0CxI,KAA1C,EAAgDuC,QAAhD,EAAyDwF,QAAzD,EAAkEzD,QAAlE;AACA,6BAAO1E,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAlC,EAArB,CAAP;AACD,qBAHD;AAIH,mBARD;AASD,iBAdD,MAcK;AACHvC,6BAAW+J,8BAAX,CAA0CxI,KAA1C,EAAgDuC,QAAhD,EAAyDwF,QAAzD,EAAkEzD,QAAlE;AACA,yBAAO1E,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAlC,EAArB,CAAP;AACD;AAEF,eAvBD;AAwBH,aApCD;AAqCD,WA7CD;AA8CD,SAhDD;AAiDD,OAnDD;AAoDAJ,UAAIkB,OAAJ;AACD,KAxDD;AAyDD,GAtFD;;AAwFA,OAAK2G,eAAL,GAAuB,UAASxJ,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAE5C;;AAEA,QAAIlB,MAAMM,IAAIa,IAAJ,CAASG,SAAf,KAA6BtB,MAAMM,IAAIa,IAAJ,CAAS4E,YAAf,CAA7B,IAA6D/F,MAAMM,IAAIa,IAAJ,CAASE,KAAf,CAAjE,EACE,OAAOJ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;;AAEF,QAAIN,QAAQf,IAAIa,IAAJ,CAASE,KAArB;AAAA,QACIgB,SAAS/B,IAAIa,IAAJ,CAASkB,MADtB;AAAA,QAEIsD,WAAWrF,IAAIa,IAAJ,CAASwE,QAFxB;AAAA,QAGIrE,YAAYhB,IAAIa,IAAJ,CAASG,SAHzB;AAAA,QAIIO,WAAWvB,IAAIa,IAAJ,CAASU,QAJxB;AAAA,QAKIkE,eAAezF,IAAIa,IAAJ,CAAS4E,YAL5B;AAAA,QAMIe,gBAAgBxG,IAAIa,IAAJ,CAAS2F,aAN7B;AAAA,QAOIiD,mBAAmBzJ,IAAIa,IAAJ,CAAS4I,gBAPhC;AAAA,QAQIC,cAAc1J,IAAIa,IAAJ,CAAS6I,WAR3B;;AAUA,QAAGhK,MAAM8G,aAAN,CAAH,EAAwB;AACtBA,sBAAgB,MAAhB;AACD;;AAEDtH,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAETpC,gBAAUqK,yBAAV,CAAoChI,GAApC,EAAwC0D,QAAxC,EAAiDqE,WAAjD,EAA6D/I,GAA7D,EAAiE,UAASkB,MAAT,EAAgB;;AAE/EvC,kBAAUwC,gBAAV,CAA2BH,GAA3B,EAA+B6E,aAA/B,EAA6C7F,GAA7C,EAAiD,UAASkB,MAAT,EAAgB;;AAE/D,cAAIyH,iBAAiBzH,OAAOE,MAA5B;;AAEA,cAAIuB,WAAWtC,YAAU,GAAV,GAAcO,QAA7B;;AAEA,cAAIW,MAAM,uCAAqCmD,QAArC,GAA8C,uBAA9C,GAAsErE,SAAtE,GAAgF,sBAAhF,GAAuGO,QAAvG,GAAgH;iCAAhH,GACckE,YADd,GAC2B,wBAD3B,GACoD6D,cADpD,GACmE,0CADnE,GAC8GvH,MAD9G,GACqH,GAD/H;;AAGA;;AAEAJ,cAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;AAC/B,gBAAGV,GAAH,EACE,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEF,gBAAGmE,iBAAiB,MAApB,EAA2B;;AAEzB,kBAAGA,iBAAiBiD,gBAApB,EAAqC;AACnC,oBAAInH,OAAO;;gCAAA,GAEMvB,KAFN,GAEY,KAFZ,GAEkByF,aAFlB,GAEgC,mBAF3C;;AAIA7E,oBAAIQ,KAAJ,CAAUG,IAAV,EAAgB,UAASC,IAAT,EAAcC,KAAd,EAAoB;AAClC,sBAAGD,IAAH,EACE,OAAO5B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASkB,KAAKF,IAA9B,EAArB,CAAP;;AAEF,yBAAO1B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAlC,EAArB,CAAP;AACD,iBALD;AAOD,eAZD,MAYK;AACH,uBAAOpB,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAlC,EAArB,CAAP;AACD;AAEF,aAlBD,MAkBK;AACH,qBAAOpB,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAA6BP,MAAK,EAAC,UAASL,MAAV,EAAlC,EAArB,CAAP;AACD;AAEF,WA1BD;AA4BD,SAvCD;AAwCD,OA1CD;;AA4CAJ,UAAIkB,OAAJ;AACD,KAhDD;AAiDD,GAtED;;AAyEA,OAAK+G,kBAAL,GAA0B,UAAS5J,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;;AAE/C,QAAIlB,MAAMM,IAAIa,IAAJ,CAASE,KAAf,KAAyBrB,MAAMM,IAAIa,IAAJ,CAASiI,QAAf,CAAzB,IAAqDpJ,MAAMM,IAAIa,IAAJ,CAASgJ,cAAf,CAAzD,EACE,OAAOlJ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;;AAEF,QAAIN,QAAQf,IAAIa,IAAJ,CAASE,KAArB;AAAA,QACI+H,WAAWzJ,OAAO0J,QAAP,CAAgB/I,IAAIa,IAAJ,CAASiI,QAAzB,EAAmC,EAAnC,CADf;AAAA,QAEIe,iBAAiB7J,IAAIa,IAAJ,CAASgJ,cAF9B;;AAIA,QAAG7J,IAAIa,IAAJ,CAASiI,QAAT,IAAqB9I,IAAIa,IAAJ,CAASgJ,cAAjC,EACE,OAAOlJ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,wBAAzB,EAArB,CAAP;;AAEFnC,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;;AAElC,UAAIO,MAAM,uCAAqC4G,QAArC,GAA8C,6CAA9C,GAA4F/H,KAA5F,GAAkG,GAA5G;;AAEAY,UAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;AAC/BT,YAAIkB,OAAJ;AACA,YAAGnB,GAAH,EACE,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEA,eAAO1B,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBuB,SAAQ,IAAxB,EAArB,CAAP;AACH,OAND;AAOD,KAXD;AAYD,GAxBD;;AA0BA,OAAKmH,MAAL,GAAc,UAAS9J,GAAT,EAAaW,GAAb,EAAiBC,IAAjB,EAAuB;AACnC,QAAImB,SAAS/B,IAAIa,IAAJ,CAASkB,MAAtB;;AAEA7C,eAAWuC,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAET,UAAIQ,MAAM,wCAAsCH,MAAtC,GAA6C,GAAvD;;AAEAJ,UAAIQ,KAAJ,CAAUD,GAAV,EAAe,UAASR,GAAT,EAAaU,IAAb,EAAkB;AAC/BT,YAAIkB,OAAJ;AACA,YAAGnB,GAAH,EACI,OAAOf,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASK,IAAIW,IAA7B,EAArB,CAAP;;AAEJ,YAAGD,KAAK6G,YAAL,IAAqB,CAAxB,EACE,OAAOtI,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,8CAAzB,EAArB,CAAP;;AAEF,eAAOV,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACJC,sBAAW,GADP;AAEJuB,mBAAQ;AAFJ,SAArB,CAAP;AAKD,OAbD;AAcD,KAnBD;AAoBD,GAvBD;AAwBD;;AAEDoH,OAAOC,OAAP,GAAiB,IAAIvJ,KAAJ,EAAjB","file":"user.js","sourcesContent":["var connection = require('../../../config/db');\n\nvar jwt = require('jsonwebtoken'),\n    bcrypt = require('bcrypt'),\n    userModel = require('../models/user'),\n    generalModel = require('../models/general'),\n    emailModel = require('../models/email'),\n    cfg = require('../../../config'),\n    empty = require('is-empty');\n\nconst axios = require('axios');\nvar multer = require('multer');\n\nvar storage = multer.diskStorage({\n    destination: (req, file, cb) => {\n      cb(null, '../public/uploads/users')\n    },\n    filename: (req, file, cb) => {\n\n      switch(file.mimetype){\n        case 'image/jpeg':\n          var ext = '.jpeg';\n        break;\n        case 'image/jpg':\n          var ext = '.jpg';\n        break;\n        case 'image/png':\n          var ext = '.png';\n        break;\n      }\n\n      cb(null, Date.now()+''+ext);\n    }\n});\n\nvar upload = multer({storage: storage});\n \nfunction cUser() {\n\n  this.userRegister = function(req,res,next) {\n\n    if( empty(req.body.inviterEmail) || empty(req.body.email) || empty(req.body.firstName) || empty(req.body.phoneNumber) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n    \n    var inviterUsername = req.body.inviterUsername,\n        inviterEmail = req.body.inviterEmail,\n        email = req.body.email,\n        firstName = req.body.firstName,\n        lastName = req.body.lastName,\n        phone = req.body.phoneNumber,\n        status = 2;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.checkEmailExist(con,email,res,function(result){  \n\n        userModel.getUserIdByEmail(con,inviterEmail,res,function(result){\n\n          var userId = result.userId;\n\n          userModel.getReferalCodeByEmail(con,inviterEmail,res,function(result){\n\n            var referalCode = result.referalCode;\n\n            var sql = \"INSERT INTO users (user_email,user_firstname,user_lastname,user_mobile_number,user_invited_by,user_referal_code,status,post_date) \\\n                      VALUES ('\"+email+\"', '\"+firstName+\"','\"+lastName+\"', '\"+phone+\"', '\"+userId+\"', '\"+referalCode+\"', '\"+status+\"', NOW())\";\n\n              \n            con.query(sql, function(err,data){\n                \n              if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n              var sql2 = \"INSERT INTO conversations (UserID_One, UserID_Two, UserOneStatus, UserTwoStatus, \\\n                        TransactTime) \\\n                        VALUES ('\"+email+\"','\"+inviterEmail+\"','2','2', NOW())\";\n\n              con.query(sql2, function(err2,data2){\n                if(err2)\n                  return res.status(500).json({statusCode:500,message: err2.code});\n\n                userModel.updatePointByEmail(con,inviterEmail,1,res,function(result){\n                  emailModel.sendEmailRegister(email,firstName,inviterUsername);\n                  return res.status(200).json({statusCode:200,success:true,data:{\"userId\":data.insertId}});\n                });\n              });               \n            });\n          });      \n        });\n      });\n\n      con.release();\n\n    });\n  };\n\n\n  this.userDetail = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = 'SELECT *, user_id as id, user_invited_by as invited_id, (select count(user_id) from users WHERE user_invited_by = id) as total_invited, (select user_email FROM users WHERE user_id = invited_id) as inviter_email, \\\n            (select count(user_id) from users WHERE user_invited_by = id AND status = \"1\") as member_joined, (select count(user_id) from users WHERE user_invited_by = id AND status = \"2\") as member_prospect, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n            AS rank FROM users WHERE user_id='+req.params.id+' LIMIT 1'\n          \n          //console.log(sql);\n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              \n              var dt = [];\n              var pp = (data[0].user_photo) ? cfg.photoProfileUrl+''+data[0].user_photo : null;\n\n              var fullName = data[0].user_firstname+' '+data[0].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              var statusAccount = \"\";\n\n              if(data[0].status == 0){\n                statusAccount = \"inactive\";\n              }\n\n              if(data[0].status == 1){\n                statusAccount = \"member\";\n              }\n\n              if(data[0].status == 2){\n                statusAccount = \"prospek\";\n              }\n\n              dt.push({\n                \"userId\": data[0].user_id,\n                \"email\": data[0].user_email,\n                \"username\": data[0].user_username,\n                \"firstName\": data[0].user_firstname,\n                \"lastName\": data[0].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[0].user_mobile_number,\n                \"phoneNumber\": data[0].user_phone_number,\n                \"line\": data[0].user_line,\n                \"whatsapp\": data[0].user_whatsapp,\n                \"facebook\": data[0].user_facebook,\n                \"instagram\": data[0].user_instagram,\n                \"wechat\": data[0].user_wechat,\n                \"country\": data[0].user_country,\n                \"address1\": data[0].user_address1,\n                \"address2\": data[0].user_address2,\n                \"language\": data[0].user_language,\n                \"ranking\": data[0].rank,\n                \"url\": \"https://morichworldwide.com/\"+data[0].user_username,\n                \"totalInvited\": data[0].total_invited,\n                \"memberJoined\": data[0].member_joined,\n                \"memberProspect\": data[0].member_prospect,\n                \"emailInviter\": empty(data[0].inviter_email) ? 'root' : data[0].inviter_email,\n                \"accountStatus\": statusAccount\n              });\n\n              return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n            }\n        });\n     });\n  };\n\n  this.userDetailByUsername = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = 'SELECT *, user_id as id, user_invited_by as invited_id, (select count(user_id) from users WHERE user_invited_by = id) as total_invited, (select user_email FROM users WHERE user_id = invited_id) as inviter_email, \\\n            (select count(user_id) from users WHERE user_invited_by = id AND status = \"1\") as member_joined, (select count(user_id) from users WHERE user_invited_by = id AND status = \"2\") as member_prospect, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n            AS rank FROM users WHERE user_username=\"'+req.params.username+'\" LIMIT 1'\n          \n          //console.log(sql);\n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              \n              var dt = [];\n              var pp = (data[0].user_photo) ? cfg.photoProfileUrl+''+data[0].user_photo : null;\n\n              var fullName = data[0].user_firstname+' '+data[0].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              var statusAccount = \"\";\n\n              if(data[0].status == 0){\n                statusAccount = \"inactive\";\n              }\n\n              if(data[0].status == 1){\n                statusAccount = \"member\";\n              }\n\n              if(data[0].status == 2){\n                statusAccount = \"prospek\";\n              }\n\n              dt.push({\n                \"userId\": data[0].user_id,\n                \"email\": data[0].user_email,\n                \"username\": data[0].user_username,\n                \"firstName\": data[0].user_firstname,\n                \"lastName\": data[0].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[0].user_mobile_number,\n                \"phoneNumber\": data[0].user_phone_number,\n                \"line\": data[0].user_line,\n                \"whatsapp\": data[0].user_whatsapp,\n                \"facebook\": data[0].user_facebook,\n                \"instagram\": data[0].user_instagram,\n                \"wechat\": data[0].user_wechat,\n                \"country\": data[0].user_country,\n                \"address1\": data[0].user_address1,\n                \"address2\": data[0].user_address2,\n                \"language\": data[0].user_language,\n                \"ranking\": data[0].rank,\n                \"url\": \"https://morichworldwide.com/\"+data[0].user_username,\n                \"totalInvited\": data[0].total_invited,\n                \"memberJoined\": data[0].member_joined,\n                \"memberProspect\": data[0].member_prospect,\n                \"emailInviter\": empty(data[0].inviter_email) ? 'root' : data[0].inviter_email,\n                \"accountStatus\": statusAccount\n              });\n\n              return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n            }\n        });\n     });\n  };\n\n  this.userGetIdByEmail = function(req,res,next) {\n      var email = req.query.email;\n\n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n        userModel.getUserIdByEmail(con,email,res,function(result){\n\n          var userId = result.userId;\n          return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n\n        });\n        con.release();\n      }); \n  };\n\n  this.userStatisticByEmail = function(req,res,next) {\n    var email = req.query.email;\n\n    if(empty(email))\n      return res.status(500).json({statusCode:500,message: \"Parameter email is required\"});\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n        con.query('SELECT user_id as id, (select count(user_id) from users WHERE user_invited_by = id) as total_invited, \\\n          (select count(user_id) from users WHERE user_invited_by = id AND status = 1) as member_joined, (select count(user_id) from users WHERE user_invited_by = id AND status = \"2\") as member_prospect, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n          AS rank FROM users WHERE user_email=\"'+req.query.email+'\" LIMIT 1', function(err,data){\n          con.release();\n          if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n          if(data.length < 1){\n            res.status(404).json({statusCode:404,message: \"Data not found\"});\n          }else{\n            \n            var dt = [];\n\n            dt.push({\n              \"ranking\": data[0].rank,\n              \"totalInvited\": data[0].total_invited,\n              \"memberJoined\": data[0].member_joined,\n              \"memberProspect\": data[0].member_prospect\n            });\n\n            return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n          }\n      });\n    \n    });\n  };\n\n  this.userUpdate = function(req,res,next) {\n\n    if( empty(req.body.firstName) && empty(req.body.email) && empty(req.body.mobileNumber) && empty(req.body.address1) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var firstName = req.body.firstName,\n        lastName = req.body.lastName,\n        language = req.body.language,\n        email = req.body.email,\n        mobileNumber = req.body.mobileNumber,\n        phoneNumber = req.body.phoneNumber,\n        line = req.body.line,\n        whatsapp = req.body.whatsapp,\n        facebook = req.body.facebook,\n        instagram = req.body.instagram,\n        wechat = req.body.wechat,\n        country = req.body.country,\n        address1 = req.body.address1,\n        address2 = req.body.address2;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"UPDATE users set user_firstname = '\"+firstName+\"', user_lastname = '\"+lastName+\"' \\\n      ,user_language = '\"+language+\"' ,user_mobile_number = '\"+mobileNumber+\"' ,user_phone_number = '\"+phoneNumber+\"' \\\n      ,user_line = '\"+line+\"' \\\n      ,user_whatsapp = '\"+whatsapp+\"' \\\n      ,user_facebook = '\"+facebook+\"' \\\n      ,user_instagram = '\"+instagram+\"' \\\n      ,user_wechat = '\"+wechat+\"' \\\n      ,user_country = '\"+country+\"' \\\n      ,user_address1 = '\"+address1+\"' \\\n      ,user_address2 = '\"+address2+\"' \\\n      ,update_date = NOW() WHERE user_email = '\"+email+\"'\";\n        \n      con.query(sql, function(err,data){\n          \n          if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n          \n          userModel.getUserIdByEmail(con,email,res,function(result){\n            var userId = result.userId;\n            return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n          });\n      });\n\n      con.release();\n\n    });\n    \n  };\n\n  this.userUploadPhoto = function(req,res,next) {\n\n    if( empty(req.body.email) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var photoProfile = req.file.filename;\n    var email = req.body.email;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.getUserIdByEmail(con,email,res,function(result){\n\n        var userId = result.userId;\n\n        var sql = \"UPDATE users set user_photo = '\"+photoProfile+\"' \\\n        ,update_date = NOW() WHERE user_id= '\"+userId+\"'\";\n\n        con.query(sql, function(err,data){\n          \n          if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n          \n          return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId,\"photoFilename\":photoProfile}});\n        });\n      });\n\n      con.release();\n\n    });\n\n  };\n\n  this.uploadAction = upload.single('image');\n\n  this.userSubmission = function(req,res,next) {\n    \n    var referralEmail = req.body.referralEmail,\n        fullName = req.body.fullName,\n        email = req.body.email,\n        hpWa = req.body.hpWa,\n        city = req.body.city,\n        age = req.body.age,\n        languages = req.body.languages,\n        currentOccupation = req.body.currentOccupation,\n        isExperienceInMobileBusiness = req.body.isExperienceInMobileBusiness,\n        targetMobileBusiness180Days = req.body.targetMobileBusiness180Days,\n        reason = req.body.reason,\n        urgencyLevel = req.body.urgencyLevel,\n        seriousLevel = req.body.seriousLevel,\n        capitalInvestment = req.body.capitalInvestment,\n        readyToJoin = req.body.readyToJoin,\n        isAvailableContactToMobile = req.body.isAvailableContactToMobile;\n\n    if( empty(referralEmail) || empty(fullName) || empty(email) || empty(hpWa) \n      || empty(city) || empty(age) || empty(languages) || empty(currentOccupation) || \n      empty(isExperienceInMobileBusiness) || empty(targetMobileBusiness180Days) || empty(reason) || empty(urgencyLevel) || \n      empty(seriousLevel) || empty(capitalInvestment) || empty(readyToJoin) || empty(isAvailableContactToMobile) ){\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"});  \n    }\n\n    emailModel.sendEmailSubmission(req.body);\n    return res.status(200).json({statusCode:200,success:true});\n\n  };\n\n\n  this.userList = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = 'SELECT u.*, s.*, u.user_id as userID, u.post_date as postDate, s.post_date as submit_app_date, u.user_id as id, \\\n          u.user_invited_by as invited_id, \\\n          (select count(user_id) from users WHERE user_invited_by = id) as total_invited, \\\n          (select user_email FROM users WHERE user_id = invited_id) as inviter_email, \\\n          (select count(user_id) from users WHERE user_invited_by = id AND status = \"1\") as member_joined, (select count(user_id) from users WHERE user_invited_by = id AND status = \"2\") as member_prospect, \\\n          FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n          AS rank FROM users u LEFT JOIN application_submission s ON u.user_email = s.email'\n          \n          //console.log(sql);\n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n            \n            var dt = [];\n            for (var i = 0; i < data.length; i++) {\n              var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n\n              var fullName = data[i].user_firstname+' '+data[i].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              var statusAccount = \"\";\n\n              if(data[i].status == 0){\n                statusAccount = \"inactive\";\n              }\n\n              if(data[i].status == 1){\n                statusAccount = \"member\";\n              }\n\n              if(data[i].status == 2){\n                statusAccount = \"prospek\";\n              }\n\n              var app = [];\n              if(!empty(data[i].user_id)){\n                app = {\n                  \"city\": data[i].city,\n                  \"age\": data[i].age,\n                  \"occupation\": data[i].current_occupation,\n                  \"isExperienceInMobileBusiness\": data[i].is_experience_mobile_business,\n                  \"targetMobileBusiness180Days\": data[i].target_mobile_business_180_days,\n                  \"reason\": data[i].reason,\n                  \"urgencyLevel\": data[i].urgency_level,\n                  \"seriousLevel\": data[i].serious_level,\n                  \"capitalInvestment\": data[i].capital_investment,\n                  \"readyToJoin\": data[i].ready_to_join,\n                  \"isAvailableContactToMobile\": data[i].is_available_contact_to_mobile,\n                  \"submitAppDate\": data[i].submit_app_date\n                }\n              }\n\n              dt.push({\n                \"userId\": data[i].userID,\n                \"password\": empty(data[i].user_password) ? \"false\" : \"true\",\n                \"email\": data[i].user_email,\n                \"username\": data[i].user_username,\n                \"firstName\": data[i].user_firstname,\n                \"lastName\": data[i].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[i].user_mobile_number,\n                \"phoneNumber\": data[i].user_phone_number,\n                \"line\": data[i].user_line,\n                \"whatsapp\": data[i].user_whatsapp,\n                \"facebook\": data[i].user_facebook,\n                \"instagram\": data[i].user_instagram,\n                \"wechat\": data[i].user_wechat,\n                \"country\": data[i].user_country,\n                \"address1\": data[i].user_address1,\n                \"address2\": data[i].user_address2,\n                \"language\": data[i].user_language,\n                \"ranking\": data[i].rank,\n                \"url\": \"https://morichworldwide.com/\"+data[i].user_username,\n                \"totalInvited\": data[i].total_invited,\n                \"memberJoined\": data[i].member_joined,\n                \"memberProspect\": data[i].member_prospect,\n                \"emailInviter\": data[i].inviter_email,\n                \"accountStatus\": statusAccount,\n                \"inviterId\": data[i].user_invited_by,\n                \"postDate\": data[i].postDate,\n                \"city\": data[i].city,\n                \"age\": data[i].age,\n                \"occupation\": data[i].current_occupation,\n                \"isExperienceInMobileBusiness\": data[i].is_experience_mobile_business,\n                \"targetMobileBusiness180Days\": data[i].target_mobile_business_180_days,\n                \"reason\": data[i].reason,\n                \"urgencyLevel\": data[i].urgency_level,\n                \"seriousLevel\": data[i].serious_level,\n                \"capitalInvestment\": data[i].capital_investment,\n                \"readyToJoin\": data[i].ready_to_join,\n                \"isAvailableContactToMobile\": data[i].is_available_contact_to_mobile,\n                \"submitAppDate\": data[i].submit_app_date\n              });\n            }\n            return res.status(200).json({statusCode:200,success:true,data:dt});\n          });\n      });\n  };\n\n  this.activated = function(req,res,next) {\n     \n    var id = req.body.userId;\n    var email = req.body.email;\n    var username = req.body.username;\n    var inviterId = req.body.inviterId;\n    var isPassword = req.body.isPassword;\n    var status = req.body.status;\n\n    var point = \"\";\n\n    if(req.body.status == \"1\"){\n      point = 3;\n    }else{\n      point = 2;\n    }\n\n\n    var sqlNew = \"UPDATE users set status = '\"+req.body.status+\"', user_username = '\"+username+\"' \\\n      , update_date = NOW() WHERE user_id = '\"+id+\"' \";\n    var oriPassword = generalModel.getRandomStr();\n    \n    if(isPassword == \"false\"){\n      var password = bcrypt.hashSync(oriPassword, 10);\n      var sqlNew = \"UPDATE users set status = '\"+req.body.status+\"', user_username = '\"+username+\"' \\\n      ,user_password = '\"+password+\"', update_date = NOW() WHERE user_id = '\"+id+\"' \";\n    }\n\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.checkUsernameExist(con,username,res,function(result){\n\n        var sql = sqlNew;\n\n        //console.log(sql);\n          \n        con.query(sql, function(err,data){\n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.affectedRows == 0)\n              return res.status(500).json({statusCode:500,message: \"either 'email' or 'invitedBy' wrong\"});\n\n            userModel.updatePoint(con,inviterId,point,res,function(result){\n              \n              if(isPassword == \"false\"){\n                emailModel.sendTmpPassword(email,oriPassword,status,username);\n              }\n\n              return res.status(200).json({statusCode:200,success:true});\n            });\n        });\n      });\n      con.release();\n    });\n  };\n\n  this.userAdminPost = function(req,res,next) {\n\n    //console.log(req.body);\n\n    if( empty(req.body.firstName) || empty(req.body.mobileNumber) || empty(req.body.email) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var email = req.body.email,\n        username = req.body.username,\n        firstName = req.body.firstName,\n        lastName = req.body.lastName,\n        mobileNumber = req.body.mobileNumber,\n        referralEmail = req.body.referralEmail,\n        statusAccount = req.body.status,\n        password = generalModel.getRandomStr(),\n        passwordEncrypt = bcrypt.hashSync(password, 10);\n\n    if(empty(referralEmail)){\n      referralEmail = \"root\";\n    }\n\n    var point = \"\";\n\n    if(statusAccount == \"1\"){\n      point = 2;\n    }else{\n      point = 3;\n    }\n    \n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.checkEmailExist(con,email,res,function(result){\n\n        userModel.checkUsernameExist(con,username,res,function(result){\n\n          userModel.getUserIdByEmail(con,referralEmail,res,function(result){\n\n            var userIdReferral = result.userId; \n            //console.log(userIdReferral);\n\n            var sql = \"INSERT INTO users (user_email,user_password,user_firstname,user_lastname,user_mobile_number,user_invited_by,post_date) \\\n                          VALUES ('\"+email+\"', '\"+passwordEncrypt+\"', '\"+firstName+\"', '\"+lastName+\"', '\"+mobileNumber+\"','\"+userIdReferral+\"',NOW())\";\n                  \n            con.query(sql, function(err,data){\n                \n                if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n\n\n                var fullName = firstName+' '+lastName;\n\n                var userId = data.insertId;; \n                \n                var sql2 = \"UPDATE users set user_username = '\"+username+\"', status = '\"+statusAccount+\"', update_date = NOW() WHERE user_email = '\"+email+\"'\";\n              \n                con.query(sql2, function(err2,data2){\n                  if(err2)\n                    return res.status(500).json({statusCode:500,message: err2.code});\n\n                  if(referralEmail != 'root'){\n                    var sql2 = \"INSERT INTO conversations (UserID_One, UserID_Two, UserOneStatus, UserTwoStatus, \\\n                            TransactTime) \\\n                            VALUES ('\"+email+\"','\"+referralEmail+\"','2','2', NOW())\";\n\n                    con.query(sql2, function(err2,data2){\n                      if(err2)\n                        return res.status(500).json({statusCode:500,message: err2.code});\n\n                        userModel.updatePointByEmail(con,referralEmail,point,res,function(result){\n                          emailModel.sendEmailUserRegisterFromAdmin(email,fullName,password,username);\n                          return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n                        });\n                    });\n                  }else{\n                    emailModel.sendEmailUserRegisterFromAdmin(email,fullName,password,username);\n                    return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n                  }\n    \n                });\n            });\n          });\n        });\n      });\n      con.release();\n    });\n  };\n\n  this.userAdminUpdate = function(req,res,next) {\n\n    //console.log(req.body);\n\n    if( empty(req.body.firstName) || empty(req.body.mobileNumber) || empty(req.body.email) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var email = req.body.email,\n        userId = req.body.userId,\n        username = req.body.username,\n        firstName = req.body.firstName,\n        lastName = req.body.lastName,\n        mobileNumber = req.body.mobileNumber,\n        referralEmail = req.body.referralEmail,\n        oldReferralEmail = req.body.oldReferralEmail,\n        oldUsername = req.body.oldUsername;\n\n    if(empty(referralEmail)){\n      referralEmail = \"root\";\n    }\n    \n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.checkUsernameCompareExist(con,username,oldUsername,res,function(result){\n\n        userModel.getUserIdByEmail(con,referralEmail,res,function(result){\n\n          var userIdReferral = result.userId; \n\n          var fullName = firstName+' '+lastName;\n          \n          var sql = \"UPDATE users set user_username = '\"+username+\"', user_firstname = '\"+firstName+\"', user_lastname = '\"+lastName+\"', \\\n          user_mobile_number = '\"+mobileNumber+\"', user_invited_by = '\"+userIdReferral+\"', update_date = NOW() WHERE user_id = '\"+userId+\"'\";\n\n          //console.log(sql);\n        \n          con.query(sql, function(err,data){\n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n            if(referralEmail != 'root'){\n\n              if(referralEmail != oldReferralEmail){\n                var sql2 = \"INSERT INTO conversations (UserID_One, UserID_Two, UserOneStatus, UserTwoStatus, \\\n                      TransactTime) \\\n                      VALUES ('\"+email+\"','\"+referralEmail+\"','2','2', NOW())\";\n\n                con.query(sql2, function(err2,data2){\n                  if(err2)\n                    return res.status(500).json({statusCode:500,message: err2.code});\n\n                  return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n                });\n              \n              }else{\n                return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});  \n              }\n              \n            }else{\n              return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n            }\n\n          });\n          \n        });\n      });\n      \n      con.release();\n    });\n  };\n\n\n  this.userChangePassword = function(req,res,next) {\n\n    if( empty(req.body.email) || empty(req.body.password) || empty(req.body.retypePassword) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var email = req.body.email,\n        password = bcrypt.hashSync(req.body.password, 10),\n        retypePassword = req.body.retypePassword;\n\n    if(req.body.password != req.body.retypePassword)\n      return res.status(500).json({statusCode:500,message: \"Password doesn't match\"});\n\n    connection.acquire(function(err,con){\n        \n      var sql = \"UPDATE users set user_password = '\"+password+\"', update_date = NOW() WHERE user_email = '\"+email+\"'\";\n        \n      con.query(sql, function(err,data){\n        con.release();\n        if(err)\n          return res.status(500).json({statusCode:500,message: err.code});\n\n          return res.status(200).json({statusCode:200,success:true}); \n      });\n    });\n  };\n\n  this.delete = function(req,res,next) {\n    var userId = req.body.userId;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"DELETE FROM users WHERE user_id = '\"+userId+\"'\";\n\n      con.query(sql, function(err,data){\n        con.release();\n        if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n\n        if(data.affectedRows == 0)\n          return res.status(500).json({statusCode:500,message: \"Failed to delete data. Check your parameter.\"}); \n\n        return res.status(200).json({\n                                statusCode:200,\n                                success:true\n                            });\n \n      });\n    });\n  };\n}\n\nmodule.exports = new cUser();"]}