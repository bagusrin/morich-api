{"version":3,"sources":["../src/app/controllers/user.js"],"names":["connection","require","jwt","bcrypt","userModel","generalModel","emailModel","cfg","empty","multer","storage","diskStorage","destination","req","file","cb","filename","mimetype","ext","Date","now","upload","cUser","userRegister","res","next","body","invitedBy","email","fullName","phoneNumber","status","json","statusCode","message","name","phone","acquire","err","con","checkEmailExist","result","getUserIdByEmail","userId","getReferalCodeByEmail","referalCode","sql","query","data","code","sendEmailRegister","success","insertId","userJoin","password","retypePassword","hashSync","checkUserReferalCode","userName","userEmail","inviterName","inviterEmail","userIdInvitedBy","inviterId","splitName","trim","split","length","uname","toLowerCase","sql2","err2","data2","updatePoint","sendEmailCompleteRegister","release","userDetail","params","id","dt","pp","user_photo","photoProfileUrl","user_firstname","user_lastname","initialName","charAt","toUpperCase","push","user_id","user_email","user_mobile_number","user_phone_number","user_line","user_whatsapp","user_facebook","user_instagram","user_wechat","user_country","user_address1","user_address2","user_language","rank","user_username","total_invited","member_joined","inviter_email","userDetailByUsername","username","userGetIdByEmail","userStatisticByEmail","userUpdate","firstName","mobileNumber","address1","lastName","language","line","whatsapp","facebook","instagram","wechat","country","address2","userUploadPhoto","photoProfile","uploadAction","single","userSubmission","city","age","currentOccupation","isExperienceInMobileBusiness","targetMobileBusiness180Days","reason","urgencyLevel","seriousLevel","capitalInvestment","readyToJoin","isAvailableContactToMobile","console","log","userList","i","user_invited_by","activated","affectedRows","userAdminPost","getRandomStr","passwordEncrypt","sendEmailUserRegisterFromAdmin","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["var connection = require('../../../config/db');\n\nvar jwt = require('jsonwebtoken'),\n    bcrypt = require('bcrypt'),\n    userModel = require('../models/user'),\n    generalModel = require('../models/general'),\n    emailModel = require('../models/email'),\n    cfg = require('../../../config'),\n    empty = require('is-empty');\n\nvar multer = require('multer');\n\nvar storage = multer.diskStorage({\n    destination: (req, file, cb) => {\n      cb(null, '../public/uploads/users')\n    },\n    filename: (req, file, cb) => {\n\n      switch(file.mimetype){\n        case 'image/jpeg':\n          var ext = '.jpeg';\n        break;\n        case 'image/jpg':\n          var ext = '.jpg';\n        break;\n        case 'image/png':\n          var ext = '.png';\n        break;\n      }\n\n      cb(null, Date.now()+''+ext);\n    }\n});\n\nvar upload = multer({storage: storage});\n \nfunction cUser() {\n\n  this.userRegister = function(req,res,next) {\n\n    if( empty(req.body.invitedBy) || empty(req.body.email) || empty(req.body.fullName) || empty(req.body.phoneNumber) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n    \n    var invitedBy = req.body.invitedBy,\n        email = req.body.email,\n        name = req.body.fullName,\n        phone = req.body.phoneNumber,\n        status = 0;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.checkEmailExist(con,email,res,function(result){  \n\n        userModel.getUserIdByEmail(con,invitedBy,res,function(result){\n\n          var userId = result.userId;\n\n          userModel.getReferalCodeByEmail(con,invitedBy,res,function(result){\n\n            var referalCode = result.referalCode;\n\n            var sql = \"INSERT INTO users (user_email,user_firstname,user_lastname,user_mobile_number,user_invited_by,user_referal_code,status,post_date) \\\n                      VALUES ('\"+email+\"', '\"+name+\"', '', '\"+phone+\"', '\"+userId+\"', '\"+referalCode+\"', '\"+status+\"', NOW())\";\n              \n            con.query(sql, function(err,data){\n                \n                if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                \n                emailModel.sendEmailRegister(email,referalCode)\n                return res.status(200).json({statusCode:200,success:true,data:{\"userId\":data.insertId}});\n            });\n          });      \n        });\n      });\n\n    });\n  };\n\n  this.userJoin = function(req,res,next) {\n\n    if( empty(req.body.invitedBy) || empty(req.body.email) || empty(req.body.password) || empty(req.body.retypePassword) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var invitedBy = req.body.invitedBy,\n        email = req.body.email,\n        password = bcrypt.hashSync(req.body.password, 10),\n        retypePassword = req.body.retypePassword;\n\n    if(req.body.password != req.body.retypePassword)\n      return res.status(500).json({statusCode:500,message: \"Password doesn't match\"});\n\n    \n    connection.acquire(function(err,con){\n\n\n      userModel.checkUserReferalCode(con,email,invitedBy,res,function(result){\n\n        var userName = result.userName;\n        var userEmail = result.userEmail;\n        var userId = result.userId;\n        var inviterName = result.inviterName;\n        var inviterEmail = result.inviterEmail;\n        var userIdInvitedBy = result.inviterId;\n\n        var splitName = userName.trim().split(\" \");\n\n        if(splitName.length > 1){\n          var uname = splitName[0]+''+userId;\n        }else{\n          var uname = splitName[0]+''+userId;\n        }\n\n        uname = uname.toLowerCase();  \n\n        var sql = \"UPDATE users set user_username = '\"+uname+\"', user_password = '\"+password+\"', status = 2, update_date = NOW() WHERE user_email = '\"+email+\"'\";\n          \n        con.query(sql, function(err,data){\n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n            var sql2 = \"INSERT INTO conversations (UserID_One, UserID_Two, UserOneStatus, UserTwoStatus, \\\n            TransactTime) \\\n            VALUES ('\"+userEmail+\"','\"+inviterEmail+\"','2','2', NOW())\";\n\n            con.query(sql2, function(err2,data2){\n              if(err2)\n                return res.status(500).json({statusCode:500,message: err2.code});\n              \n              userModel.updatePoint(con,userIdInvitedBy,1,res,function(result){\n                emailModel.sendEmailCompleteRegister(userName,userEmail,inviterName,inviterEmail);\n                return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n              });\n            });\n        });\n\n          con.release();\n      });\n\n    \n    });\n  };\n\n  this.userDetail = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = 'SELECT *, user_id as id, user_invited_by as invited_id, (select count(user_id) from users WHERE user_invited_by = id) as total_invited, (select user_email FROM users WHERE user_id = invited_id) as inviter_email, \\\n            (select count(user_id) from users WHERE user_invited_by = id AND status <> \"0\") as member_joined, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n            AS rank FROM users WHERE user_id='+req.params.id+' LIMIT 1'\n          \n          //console.log(sql);\n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              \n              var dt = [];\n              var pp = (data[0].user_photo) ? cfg.photoProfileUrl+''+data[0].user_photo : null;\n\n              var fullName = data[0].user_firstname+' '+data[0].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              dt.push({\n                \"userId\": data[0].user_id,\n                \"email\": data[0].user_email,\n                \"firstName\": data[0].user_firstname,\n                \"lastName\": data[0].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[0].user_mobile_number,\n                \"phoneNumber\": data[0].user_phone_number,\n                \"line\": data[0].user_line,\n                \"whatsapp\": data[0].user_whatsapp,\n                \"facebook\": data[0].user_facebook,\n                \"instagram\": data[0].user_instagram,\n                \"wechat\": data[0].user_wechat,\n                \"country\": data[0].user_country,\n                \"address1\": data[0].user_address1,\n                \"address2\": data[0].user_address2,\n                \"language\": data[0].user_language,\n                \"ranking\": data[0].rank,\n                \"url\": \"https://morichworldwide.com/\"+data[0].user_username,\n                \"totalInvited\": data[0].total_invited,\n                \"memberJoined\": data[0].member_joined,\n                \"emailInviter\": data[0].inviter_email\n              });\n\n              return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n            }\n        });\n     });\n  };\n\n  this.userDetailByUsername = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n          con.query('SELECT *, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n        AS rank FROM users WHERE user_username=\"'+req.params.username+'\" LIMIT 1', function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              \n              var dt = [];\n              var pp = (data[0].user_photo) ? cfg.photoProfileUrl+''+data[0].user_photo : null;\n\n              var fullName = data[0].user_firstname+' '+data[0].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              dt.push({\n                \"userId\": data[0].user_id,\n                \"email\": data[0].user_email,\n                \"firstName\": data[0].user_firstname,\n                \"lastName\": data[0].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[0].user_mobile_number,\n                \"phoneNumber\": data[0].user_phone_number,\n                \"line\": data[0].user_line,\n                \"whatsapp\": data[0].user_whatsapp,\n                \"facebook\": data[0].user_facebook,\n                \"instagram\": data[0].user_instagram,\n                \"wechat\": data[0].user_wechat,\n                \"country\": data[0].user_country,\n                \"address1\": data[0].user_address1,\n                \"address2\": data[0].user_address2,\n                \"language\": data[0].user_language,\n                \"ranking\": data[0].rank,\n                \"url\": \"https://morichworldwide.com/\"+data[0].user_username\n              });\n\n              return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n            }\n        });\n     });\n  };\n\n  this.userGetIdByEmail = function(req,res,next) {\n      var email = req.query.email;\n\n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n        userModel.getUserIdByEmail(con,email,res,function(result){\n\n          var userId = result.userId;\n          return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n\n        });\n        con.release();\n      }); \n  };\n\n  this.userStatisticByEmail = function(req,res,next) {\n    var email = req.query.email;\n\n    if(empty(email))\n      return res.status(500).json({statusCode:500,message: \"Parameter email is required\"});\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n        con.query('SELECT user_id as id, (select count(user_id) from users WHERE user_invited_by = id) as total_invited, \\\n          (select count(user_id) from users WHERE user_invited_by = id AND status <> 0) as member_joined, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n          AS rank FROM users WHERE user_email=\"'+req.query.email+'\" LIMIT 1', function(err,data){\n          con.release();\n          if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n          if(data.length < 1){\n            res.status(404).json({statusCode:404,message: \"Data not found\"});\n          }else{\n            \n            var dt = [];\n\n            dt.push({\n              \"ranking\": data[0].rank,\n              \"totalInvited\": data[0].total_invited,\n              \"memberJoined\": data[0].member_joined\n            });\n\n            return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n          }\n      });\n    \n    });\n  };\n\n  this.userUpdate = function(req,res,next) {\n\n    if( empty(req.body.firstName) && empty(req.body.email) && empty(req.body.mobileNumber) && empty(req.body.address1) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var firstName = req.body.firstName,\n        lastName = req.body.lastName,\n        language = req.body.language,\n        email = req.body.email,\n        mobileNumber = req.body.mobileNumber,\n        phoneNumber = req.body.phoneNumber,\n        line = req.body.line,\n        whatsapp = req.body.whatsapp,\n        facebook = req.body.facebook,\n        instagram = req.body.instagram,\n        wechat = req.body.wechat,\n        country = req.body.country,\n        address1 = req.body.address1,\n        address2 = req.body.address2;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"UPDATE users set user_firstname = '\"+firstName+\"', user_lastname = '\"+lastName+\"' \\\n      ,user_language = '\"+language+\"' ,user_mobile_number = '\"+mobileNumber+\"' ,user_phone_number = '\"+phoneNumber+\"' \\\n      ,user_line = '\"+line+\"' \\\n      ,user_whatsapp = '\"+whatsapp+\"' \\\n      ,user_facebook = '\"+facebook+\"' \\\n      ,user_instagram = '\"+instagram+\"' \\\n      ,user_wechat = '\"+wechat+\"' \\\n      ,user_country = '\"+country+\"' \\\n      ,user_address1 = '\"+address1+\"' \\\n      ,user_address2 = '\"+address2+\"' \\\n      ,update_date = NOW() WHERE user_email = '\"+email+\"'\";\n        \n      con.query(sql, function(err,data){\n          \n          if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n          \n          userModel.getUserIdByEmail(con,email,res,function(result){\n            var userId = result.userId;\n            return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n          });\n      });\n\n      con.release();\n\n    });\n    \n  };\n\n  this.userUploadPhoto = function(req,res,next) {\n\n    if( empty(req.body.email) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var photoProfile = req.file.filename;\n    var email = req.body.email;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.getUserIdByEmail(con,email,res,function(result){\n\n        var userId = result.userId;\n\n        var sql = \"UPDATE users set user_photo = '\"+photoProfile+\"' \\\n        ,update_date = NOW() WHERE user_id= '\"+userId+\"'\";\n\n        con.query(sql, function(err,data){\n          \n          if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n          \n          return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId,\"photoFilename\":photoProfile}});\n        });\n      });\n\n      con.release();\n\n    });\n\n  };\n\n  this.uploadAction = upload.single('image');\n\n  this.userSubmission = function(req,res,next) {\n    \n    var userId = req.body.userId,\n        fullName = req.body.fullName,\n        email = req.body.email,\n        phoneNumber = req.body.phoneNumber,\n        mobileNumber = req.body.mobileNumber,\n        city = req.body.city,\n        age = req.body.age,\n        currentOccupation = req.body.currentOccupation,\n        isExperienceInMobileBusiness = req.body.isExperienceInMobileBusiness,\n        targetMobileBusiness180Days = req.body.targetMobileBusiness180Days,\n        reason = req.body.reason,\n        urgencyLevel = req.body.urgencyLevel,\n        seriousLevel = req.body.seriousLevel,\n        capitalInvestment = req.body.capitalInvestment,\n        readyToJoin = req.body.readyToJoin,\n        isAvailableContactToMobile = req.body.isAvailableContactToMobile;\n\n    if( empty(userId) || empty(fullName) || empty(email) || empty(mobileNumber) || empty(mobileNumber) \n      || empty(mobileNumber) || empty(mobileNumber) || empty(mobileNumber) || empty(mobileNumber) || \n      empty(mobileNumber) || empty(mobileNumber) || empty(mobileNumber) || empty(mobileNumber) || \n      empty(mobileNumber) || empty(mobileNumber) ){\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"});  \n    }\n\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"INSERT INTO application_submission (user_id,fullname,email,phone_number,mobile_number,city,age,\\\n                current_occupation, is_experience_mobile_business, target_mobile_business_180_days,\\\n                reason,urgency_level,serious_level,capital_investment,ready_to_join,is_available_contact_to_mobile,post_date)\\\n                VALUES ('\"+userId+\"', '\"+fullName+\"', '\"+email+\"', '\"+phoneNumber+\"', '\"+mobileNumber+\"', '\"+city+\"', '\"+age+\"', \\\n                '\"+currentOccupation+\"', '\"+isExperienceInMobileBusiness+\"', '\"+targetMobileBusiness180Days+\"', '\"+reason+\"', '\"+urgencyLevel+\"', '\"+seriousLevel+\"', '\"+capitalInvestment+\"', \\\n                '\"+readyToJoin+\"', '\"+isAvailableContactToMobile+\"', NOW())\";\n\n                console.log(sql);\n        \n      con.query(sql, function(err,data){\n          con.release();\n          if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n\n          return res.status(200).json({statusCode:200,success:true,data:{\"submissionId\":data.insertId,\"userId\":userId}});\n      });\n    });  \n  };\n\n  this.userList = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = 'SELECT *, user_id as id, user_invited_by as invited_id, (select count(user_id) from users WHERE user_invited_by = id) as total_invited, (select user_email FROM users WHERE user_id = invited_id) as inviter_email, \\\n            (select count(user_id) from users WHERE user_invited_by = id AND status <> \"0\") as member_joined, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n            AS rank FROM users'\n          \n          //console.log(sql);\n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n            \n            var dt = [];\n            for (var i = 0; i < data.length; i++) {\n              var pp = (data[i].user_photo) ? cfg.photoProfileUrl+''+data[i].user_photo : null;\n\n              var fullName = data[i].user_firstname+' '+data[i].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              dt.push({\n                \"userId\": data[i].user_id,\n                \"email\": data[i].user_email,\n                \"firstName\": data[i].user_firstname,\n                \"lastName\": data[i].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[i].user_mobile_number,\n                \"phoneNumber\": data[i].user_phone_number,\n                \"line\": data[i].user_line,\n                \"whatsapp\": data[i].user_whatsapp,\n                \"facebook\": data[i].user_facebook,\n                \"instagram\": data[i].user_instagram,\n                \"wechat\": data[i].user_wechat,\n                \"country\": data[i].user_country,\n                \"address1\": data[i].user_address1,\n                \"address2\": data[i].user_address2,\n                \"language\": data[i].user_language,\n                \"ranking\": data[i].rank,\n                \"url\": \"https://morichworldwide.com/\"+data[i].user_username,\n                \"totalInvited\": data[i].total_invited,\n                \"memberJoined\": data[i].member_joined,\n                \"emailInviter\": data[i].inviter_email,\n                \"status\": data[i].status,\n                \"inviterId\": data[i].user_invited_by\n              });\n            }\n            return res.status(200).json({statusCode:200,success:true,data:dt});\n          });\n      });\n  };\n\n  this.activated = function(req,res,next) {\n     \n    var id = req.body.userId;\n    var inviterId = req.body.inviterId;\n\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"UPDATE users set status = 1 \\\n      ,update_date = NOW() WHERE user_id = '\"+id+\"' \";\n        \n      con.query(sql, function(err,data){\n          if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n\n          if(data.affectedRows == 0)\n            return res.status(500).json({statusCode:500,message: \"either 'email' or 'invitedBy' wrong\"});\n\n          userModel.updatePoint(inviterId,3,res,function(result){\n            return res.status(200).json({statusCode:200,success:true});\n          });\n      });\n      con.release();\n    });\n  };\n\n  this.userAdminPost = function(req,res,next) {\n\n    if( empty(req.body.firstName) || empty(req.body.lastName) || empty(req.body.mobileNumber) || empty(req.body.email) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var email = req.body.email,\n        firstName = req.body.firstName,\n        lastName = req.body.lastName,\n        mobileNumber = req.body.mobileNumber,\n        password = generalModel.getRandomStr(),\n        passwordEncrypt = bcrypt.hashSync(password, 10);\n    \n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      userModel.checkEmailExist(con,email,res,function(result){ \n\n        var sql = \"INSERT INTO users (user_email,user_password,user_firstname,user_lastname,user_mobile_number,user_invited_by,post_date) \\\n                      VALUES ('\"+email+\"', '\"+passwordEncrypt+\"', '\"+firstName+\"', '\"+lastName+\"', '\"+mobileNumber+\"','root',NOW())\";\n              \n        con.query(sql, function(err,data){\n            \n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n\n            var fullName = firstName+' '+lastName;\n            var splitName = fullName.trim().split(\" \");\n\n            if(splitName.length > 1){\n              var uname = splitName[0]+''+data.insertId;\n            }else{\n              var uname = splitName[0]+''+data.insertId;\n            }\n\n            uname = uname.toLowerCase();\n\n            var userId = data.insertId;; \n            \n            var sql2 = \"UPDATE users set user_username = '\"+uname+\"', status = 1, update_date = NOW() WHERE user_email = '\"+email+\"'\";\n          \n            con.query(sql2, function(err2,data2){\n              if(err2)\n                return res.status(500).json({statusCode:500,message: err2.code});\n\n              emailModel.sendEmailUserRegisterFromAdmin(email,fullName,password);\n              return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});  \n            });\n        });\n        con.release();\n      })\n    });\n  };\n}\nmodule.exports = new cUser();"]}