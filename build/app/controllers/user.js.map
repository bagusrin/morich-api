{"version":3,"sources":["../src/app/controllers/user.js"],"names":["connection","require","jwt","bcrypt","userModel","emailModel","cfg","empty","multer","storage","diskStorage","destination","req","file","cb","filename","mimetype","ext","Date","now","upload","cUser","userRegister","res","next","body","invitedBy","email","fullName","phoneNumber","status","json","statusCode","message","name","phone","checkEmailExist","result","getUserIdByEmail","userId","getReferalCodeByEmail","referalCode","acquire","err","con","sql","query","data","code","sendEmailRegister","success","insertId","userJoin","password","retypePassword","hashSync","checkUserReferalCode","userName","userEmail","inviterName","inviterEmail","userIdInvitedBy","inviterId","splitName","trim","split","length","uname","toLowerCase","updatePoint","sendEmailCompleteRegister","userDetail","params","id","release","dt","pp","user_photo","photoProfileUrl","user_firstname","user_lastname","initialName","charAt","toUpperCase","push","user_id","user_email","user_mobile_number","user_phone_number","user_line","user_whatsapp","user_facebook","user_instagram","user_wechat","user_country","user_address1","user_address2","user_language","rank","user_username","total_invited","member_joined","userDetailByUsername","username","userGetIdByEmail","userUpdate","firstName","mobileNumber","address1","lastName","language","line","whatsapp","facebook","instagram","wechat","country","address2","userUploadPhoto","photoProfile","uploadAction","single","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["var connection = require('../../../config/db');\n\nvar jwt = require('jsonwebtoken'),\n    bcrypt = require('bcrypt'),\n    userModel = require('../models/user'),\n    emailModel = require('../models/email'),\n    cfg = require('../../../config'),\n    empty = require('is-empty');\n\nvar multer = require('multer');\n\nvar storage = multer.diskStorage({\n    destination: (req, file, cb) => {\n      cb(null, '../public/uploads/users')\n    },\n    filename: (req, file, cb) => {\n\n      switch(file.mimetype){\n        case 'image/jpeg':\n          var ext = '.jpeg';\n        break;\n        case 'image/jpg':\n          var ext = '.jpg';\n        break;\n        case 'image/png':\n          var ext = '.png';\n        break;\n      }\n\n      cb(null, Date.now()+''+ext);\n    }\n});\n\nvar upload = multer({storage: storage});\n \nfunction cUser() {\n\n  this.userRegister = function(req,res,next) {\n\n    if( empty(req.body.invitedBy) || empty(req.body.email) || empty(req.body.fullName) || empty(req.body.phoneNumber) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n    \n    var invitedBy = req.body.invitedBy,\n        email = req.body.email,\n        name = req.body.fullName,\n        phone = req.body.phoneNumber,\n        status = 0;\n\n    userModel.checkEmailExist(email,res,function(result){  \n\n      userModel.getUserIdByEmail(invitedBy,res,function(result){\n\n        var userId = result.userId;\n\n        userModel.getReferalCodeByEmail(invitedBy,res,function(result){\n\n          var referalCode = result.referalCode;\n\n          connection.acquire(function(err,con){\n            if (err) throw err;\n\n            var sql = \"INSERT INTO users (user_email,user_firstname,user_lastname,user_mobile_number,user_invited_by,user_referal_code,status,post_date) \\\n                      VALUES ('\"+email+\"', '\"+name+\"', '', '\"+phone+\"', '\"+userId+\"', '\"+referalCode+\"', '\"+status+\"', NOW())\";\n              \n            con.query(sql, function(err,data){\n                \n                if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                \n                emailModel.sendEmailRegister(email,referalCode)\n                return res.status(200).json({statusCode:200,success:true,data:{\"userId\":data.insertId}});\n            });\n          });\n        });      \n      });\n    });\n  };\n\n  this.userJoin = function(req,res,next) {\n\n    if( empty(req.body.invitedBy) || empty(req.body.email) || empty(req.body.password) || empty(req.body.retypePassword) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var invitedBy = req.body.invitedBy,\n        email = req.body.email,\n        password = bcrypt.hashSync(req.body.password, 10),\n        retypePassword = req.body.retypePassword;\n\n    if(req.body.password != req.body.retypePassword)\n      return res.status(500).json({statusCode:500,message: \"Password doesn't match\"});\n\n    userModel.checkUserReferalCode(email,invitedBy,res,function(result){\n      //console.log(result);\n\n      var userName = result.userName;\n      var userEmail = result.userEmail;\n      var userId = result.userId;\n      var inviterName = result.inviterName;\n      var inviterEmail = result.inviterEmail;\n      var userIdInvitedBy = result.inviterId;\n\n      var splitName = userName.trim().split(\" \");\n\n      if(splitName.length > 1){\n        var uname = splitName[0]+''+userId;\n      }else{\n        var uname = splitName[0]+''+userId;\n      }\n\n      uname = uname.toLowerCase();  \n\n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n        var sql = \"UPDATE users set user_username = '\"+uname+\"', user_password = '\"+password+\"', status = 2, update_date = NOW() WHERE user_email = '\"+email+\"'\";\n          \n        con.query(sql, function(err,data){\n            \n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n            \n            userModel.updatePoint(userIdInvitedBy,1,res,function(result){\n              emailModel.sendEmailCompleteRegister(userName,userEmail,inviterName,inviterEmail);\n              return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n            });\n        });\n      });\n    });\n  };\n\n  this.userDetail = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n          con.query('SELECT *, user_id as id, (select count(user_id) from users WHERE user_invited_by = id) as total_invited, \\\n            (select count(user_id) from users WHERE user_invited_by = id AND status <> \"0\") as member_joined, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n            AS rank FROM users WHERE user_id='+req.params.id+' LIMIT 1', function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              \n              var dt = [];\n              var pp = (data[0].user_photo) ? cfg.photoProfileUrl+''+data[0].user_photo : null;\n\n              var fullName = data[0].user_firstname+' '+data[0].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              dt.push({\n                \"userId\": data[0].user_id,\n                \"email\": data[0].user_email,\n                \"firstName\": data[0].user_firstname,\n                \"lastName\": data[0].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[0].user_mobile_number,\n                \"phoneNumber\": data[0].user_phone_number,\n                \"line\": data[0].user_line,\n                \"whatsapp\": data[0].user_whatsapp,\n                \"facebook\": data[0].user_facebook,\n                \"instagram\": data[0].user_instagram,\n                \"wechat\": data[0].user_wechat,\n                \"country\": data[0].user_country,\n                \"address1\": data[0].user_address1,\n                \"address2\": data[0].user_address2,\n                \"language\": data[0].user_language,\n                \"ranking\": data[0].rank,\n                \"url\": \"http://morichweb.perihal.id/\"+data[0].user_username,\n                \"totalInvited\": data[0].total_invited,\n                \"memberJoined\": data[0].member_joined\n              });\n\n              return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n            }\n        });\n     });\n  };\n\n  this.userDetailByUsername = function(req,res,next) {\n     connection.acquire(function(err,con){\n        if (err) throw err;\n          con.query('SELECT *, FIND_IN_SET( user_point, (SELECT GROUP_CONCAT( user_point ORDER BY user_point DESC ) FROM users )) \\\n        AS rank FROM users WHERE user_username=\"'+req.params.username+'\" LIMIT 1', function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              \n              var dt = [];\n              var pp = (data[0].user_photo) ? cfg.photoProfileUrl+''+data[0].user_photo : null;\n\n              var fullName = data[0].user_firstname+' '+data[0].user_lastname;\n\n              var splitName = fullName.trim().split(\" \");\n\n              if(splitName.length > 1){\n                var initialName = splitName[0].charAt(0)+''+splitName[1].charAt(0);\n              }else{\n                var initialName = splitName[0].charAt(0);\n              }\n\n              initialName = initialName.toUpperCase();\n\n              dt.push({\n                \"userId\": data[0].user_id,\n                \"email\": data[0].user_email,\n                \"firstName\": data[0].user_firstname,\n                \"lastName\": data[0].user_lastname,\n                \"initialName\": initialName,\n                \"photoUrl\": pp,\n                \"mobileNumber\": data[0].user_mobile_number,\n                \"phoneNumber\": data[0].user_phone_number,\n                \"line\": data[0].user_line,\n                \"whatsapp\": data[0].user_whatsapp,\n                \"facebook\": data[0].user_facebook,\n                \"instagram\": data[0].user_instagram,\n                \"wechat\": data[0].user_wechat,\n                \"country\": data[0].user_country,\n                \"address1\": data[0].user_address1,\n                \"address2\": data[0].user_address2,\n                \"language\": data[0].user_language,\n                \"ranking\": data[0].rank,\n                \"url\": \"http://morichweb.perihal.id/\"+data[0].user_username\n              });\n\n              return res.status(200).json({statusCode:200,success:true,data:dt[0]});\n            }\n        });\n     });\n  };\n\n  this.userGetIdByEmail = function(req,res,next) {\n      var email = req.query.email;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n        return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n\n      }); \n  };\n\n  this.userUpdate = function(req,res,next) {\n\n    if( empty(req.body.firstName) && empty(req.body.email) && empty(req.body.mobileNumber) && empty(req.body.address1) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var firstName = req.body.firstName,\n        lastName = req.body.lastName,\n        language = req.body.language,\n        email = req.body.email,\n        mobileNumber = req.body.mobileNumber,\n        phoneNumber = req.body.phoneNumber,\n        line = req.body.line,\n        whatsapp = req.body.whatsapp,\n        facebook = req.body.facebook,\n        instagram = req.body.instagram,\n        wechat = req.body.wechat,\n        country = req.body.country,\n        address1 = req.body.address1,\n        address2 = req.body.address2;\n\n    connection.acquire(function(err,con){\n      if (err) throw err;\n\n      var sql = \"UPDATE users set user_firstname = '\"+firstName+\"', user_lastname = '\"+lastName+\"' \\\n      ,user_language = '\"+language+\"' ,user_mobile_number = '\"+mobileNumber+\"' ,user_phone_number = '\"+phoneNumber+\"' \\\n      ,user_line = '\"+line+\"' \\\n      ,user_whatsapp = '\"+whatsapp+\"' \\\n      ,user_facebook = '\"+facebook+\"' \\\n      ,user_instagram = '\"+instagram+\"' \\\n      ,user_wechat = '\"+wechat+\"' \\\n      ,user_country = '\"+country+\"' \\\n      ,user_address1 = '\"+address1+\"' \\\n      ,user_address2 = '\"+address2+\"' \\\n      ,update_date = NOW() WHERE user_email = '\"+email+\"'\";\n        \n      con.query(sql, function(err,data){\n          //con.release();\n          \n          if(err)\n            return res.status(500).json({statusCode:500,message: err.code});\n          \n          userModel.getUserIdByEmail(email,res,function(result){\n            var userId = result.userId;\n            return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId}});\n          });\n      });\n\n      con.release();\n\n    });\n    \n  };\n\n  this.userUploadPhoto = function(req,res,next) {\n\n    if( empty(req.body.email) )\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"}); \n     \n    var photoProfile = req.file.filename;\n    var email = req.body.email;\n\n    userModel.getUserIdByEmail(email,res,function(result){\n\n        var userId = result.userId;\n\n        var sql = \"UPDATE users set user_photo = '\"+photoProfile+\"' \\\n        ,update_date = NOW() WHERE user_id= '\"+userId+\"'\";\n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n\n          con.query(sql, function(err,data){\n            \n            if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n            \n            return res.status(200).json({statusCode:200,success:true,data:{\"userId\":userId,\"photoFilename\":photoProfile}});\n          });\n        });\n    });\n  };\n\n  this.uploadAction = upload.single('image');\n}\nmodule.exports = new cUser();"]}