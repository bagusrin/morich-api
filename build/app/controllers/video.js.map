{"version":3,"sources":["../src/app/controllers/video.js"],"names":["connection","require","jwt","bcrypt","userModel","cVideo","list","req","res","next","email","query","page","undefined","limit","getUserIdByEmail","result","userId","offset","count","acquire","err","con","sql","data","release","status","json","statusCode","message","code","dt","i","length","push","video_id","video_youtube_id","video_youtube_link","video_youtube_iframe","video_youtube_image","video_title","video_desc","video_type","user_firstname","user_lastname","post_date","success","detail","videoId","params","id","post","youtubeLink","body","title","desc","youtubeId","split","youtubeIframe","youtubeImg","type","console","log","insertId","update","delete","affectedRows","module","exports"],"mappings":"AAAA,IAAIA,aAAaC,QAAQ,oBAAR,CAAjB;;AAEA,IAAIC,MAAMD,QAAQ,cAAR,CAAV;AAAA,IACIE,SAASF,QAAQ,QAAR,CADb;AAAA,IAEIG,YAAYH,QAAQ,gBAAR,CAFhB;;AAIA,SAASI,MAAT,GAAkB;;AAEhB,OAAKC,IAAL,GAAY,UAASC,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;;AAEjC,QAAIC,QAAQH,IAAII,KAAJ,CAAUD,KAAtB;AACA,QAAIE,OAAQL,IAAII,KAAJ,CAAUC,IAAV,IAAkBC,SAAnB,GAAgC,CAAhC,GAAoCN,IAAII,KAAJ,CAAUC,IAAzD;AACA,QAAIE,QAASP,IAAII,KAAJ,CAAUG,KAAV,IAAmBD,SAApB,GAAiC,EAAjC,GAAsCN,IAAII,KAAJ,CAAUG,KAA5D;;AAEAV,cAAUW,gBAAV,CAA2BL,KAA3B,EAAiCF,GAAjC,EAAqC,UAASQ,MAAT,EAAgB;;AAEnD,UAAIC,SAASD,OAAOC,MAApB;AACA,UAAIC,SAAS,CAACN,OAAO,CAAR,IAAaE,KAA1B;AACA,UAAIK,QAAQ,YAAUD,MAAV,GAAiB,GAAjB,GAAqBJ,KAAjC;;AAEAd,iBAAWoB,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,YAAID,GAAJ,EAAS,MAAMA,GAAN;;AAEP,YAAIE,MAAM;gFAAA,GAC6DN,MAD7D,GACoE,2BADpE,GACgGE,KAD1G;;AAGAG,YAAIX,KAAJ,CAAUY,GAAV,EAAe,UAASF,GAAT,EAAaG,IAAb,EAAkB;AAC/BF,cAAIG,OAAJ;AACA,cAAGJ,GAAH,EACI,OAAOb,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASR,IAAIS,IAA7B,EAArB,CAAP;;AAGJ,cAAIC,KAAK,EAAT;AACA,eAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIR,KAAKS,MAAzB,EAAiCD,GAAjC,EAAsC;AAClCD,eAAGG,IAAH,CAAQ;AACN,yBAAWV,KAAKQ,CAAL,EAAQG,QADb;AAEN,2BAAaX,KAAKQ,CAAL,EAAQI,gBAFf;AAGN,6BAAeZ,KAAKQ,CAAL,EAAQK,kBAHjB;AAIN,+BAAiBb,KAAKQ,CAAL,EAAQM,oBAJnB;AAKN,4BAAcd,KAAKQ,CAAL,EAAQO,mBALhB;AAMN,uBAASf,KAAKQ,CAAL,EAAQQ,WANX;AAON,6BAAehB,KAAKQ,CAAL,EAAQS,UAPjB;AAQN,sBAAQjB,KAAKQ,CAAL,EAAQU,UARV;AASN,wBAAUlB,KAAKQ,CAAL,EAAQW,cAAR,GAAuB,GAAvB,GAA2BnB,KAAKQ,CAAL,EAAQY,aATvC;AAUN,0BAAYpB,KAAKQ,CAAL,EAAQa;AAVd,aAAR;AAYH;;AAED,iBAAOrC,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACJC,wBAAW,GADP;AAEJkB,qBAAQ,IAFJ;AAGJtB,kBAAKO;AAHD,WAArB,CAAP;AAMH,SA5BC;AA6BH,OAnCD;AAqCD,KA3CD;AA4CD,GAlDD;;AAoDA,OAAKgB,MAAL,GAAc,UAASxC,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;;AAEjC,QAAIuC,UAAUzC,IAAI0C,MAAJ,CAAWC,EAAzB;;AAEAlD,eAAWoB,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,UAAID,GAAJ,EAAS,MAAMA,GAAN;;AAEP,UAAIE,MAAM;iFAAA,GAC8DyB,OAD9D,GACsE,WADhF;;AAGA1B,UAAIX,KAAJ,CAAUY,GAAV,EAAe,UAASF,GAAT,EAAaG,IAAb,EAAkB;AAC/BF,YAAIG,OAAJ;AACA,YAAGJ,GAAH,EACI,OAAOb,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASR,IAAIS,IAA7B,EAArB,CAAP;;AAEJ,YAAGN,KAAKS,MAAL,GAAc,CAAjB,EAAmB;AACjBzB,cAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,gBAAzB,EAArB;AACD,SAFD,MAEK;AACH,cAAIE,KAAK,EAAT;AACAA,aAAGG,IAAH,CAAQ;AACN,uBAAWV,KAAK,CAAL,EAAQW,QADb;AAEN,yBAAaX,KAAK,CAAL,EAAQY,gBAFf;AAGN,2BAAeZ,KAAK,CAAL,EAAQa,kBAHjB;AAIN,6BAAiBb,KAAK,CAAL,EAAQc,oBAJnB;AAKN,0BAAcd,KAAK,CAAL,EAAQe,mBALhB;AAMN,qBAASf,KAAK,CAAL,EAAQgB,WANX;AAON,2BAAehB,KAAK,CAAL,EAAQiB,UAPjB;AAQN,oBAAQjB,KAAK,CAAL,EAAQkB,UARV;AASN,sBAAUlB,KAAK,CAAL,EAAQmB,cAAR,GAAuB,GAAvB,GAA2BnB,KAAK,CAAL,EAAQoB,aATvC;AAUN,wBAAYpB,KAAK,CAAL,EAAQqB;AAVd,WAAR;;AAaA,iBAAOrC,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACJC,wBAAW,GADP;AAEJkB,qBAAQ,IAFJ;AAGJtB,kBAAKO,GAAG,CAAH;AAHD,WAArB,CAAP;AAKD;AACJ,OA5BC;AA6BH,KAnCD;AAoCH,GAxCD;;AA0CA,OAAKoB,IAAL,GAAY,UAAS5C,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;;AAEjC,QAAI;;AAEF,UAAI2C,cAAc7C,IAAI8C,IAAJ,CAASD,WAA3B;AACA,UAAIE,QAAQ/C,IAAI8C,IAAJ,CAASC,KAArB;AACA,UAAIC,OAAOhD,IAAI8C,IAAJ,CAASE,IAApB;AACA,UAAIC,YAAYJ,YAAYK,KAAZ,CAAkB,IAAlB,EAAwB,CAAxB,CAAhB;AACA,UAAIC,gBAAgB,+BAA6BF,SAAjD;AACA,UAAIG,aAAa,4BAA0BH,SAA1B,GAAoC,oBAArD;AACA,UAAII,OAAOrD,IAAI8C,IAAJ,CAASO,IAApB;AACA,UAAIlC,SAAS,CAAb;AACA,UAAIhB,QAAQH,IAAI8C,IAAJ,CAAS3C,KAArB;;AAEAN,gBAAUW,gBAAV,CAA2BL,KAA3B,EAAiCF,GAAjC,EAAqC,UAASQ,MAAT,EAAgB;;AAEnD,YAAIC,SAASD,OAAOC,MAApB;;AAEAjB,mBAAWoB,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,cAAID,GAAJ,EAAS,MAAMA,GAAN;;AAEP,cAAIE,MAAM;;sBAAA,GAECN,MAFD,GAEQ,KAFR,GAEcuC,SAFd,GAEwB,KAFxB,GAE8BJ,WAF9B,GAE0C,KAF1C,GAEgDM,aAFhD,GAE8D,KAF9D,GAEoEC,UAFpE,GAE+E,KAF/E,GAEqFL,KAFrF,GAE2F,MAF3F,GAEkGC,IAFlG,GAEuG,MAFvG,GAE8GK,IAF9G,GAEmH,MAFnH,GAE0HlC,MAF1H,GAEiI,WAF3I;;AAIAmC,kBAAQC,GAAR,CAAYvC,GAAZ;;AAEAD,cAAIX,KAAJ,CAAUY,GAAV,EAAe,UAASF,GAAT,EAAaG,IAAb,EAAkB;AAC/BF,gBAAIG,OAAJ;AACA,gBAAGJ,GAAH,EACI,OAAOb,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASR,IAAIS,IAA7B,EAArB,CAAP;;AAGJ,mBAAOtB,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACJC,0BAAW,GADP;AAEJkB,uBAAQ,IAFJ;AAGJtB,oBAAK,EAAC,WAAUA,KAAKuC,QAAhB;AAHD,aAArB,CAAP;AAMH,WAZC;AAaH,SAtBD;AAuBD,OA3BD;AA4BD,KAxCD,CAwCE,OAAO1C,GAAP,EAAW;AACX,aAAOb,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;AACD;AAGF,GA/CD;;AAiDA,OAAKmC,MAAL,GAAc,UAASzD,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;AACnC,QAAI;;AAEF,UAAIuC,UAAUzC,IAAI8C,IAAJ,CAASL,OAAvB;AACA,UAAII,cAAc7C,IAAI8C,IAAJ,CAASD,WAA3B;AACA,UAAIE,QAAQ/C,IAAI8C,IAAJ,CAASC,KAArB;AACA,UAAIC,OAAOhD,IAAI8C,IAAJ,CAASE,IAApB;AACA,UAAIC,YAAYJ,YAAYK,KAAZ,CAAkB,IAAlB,EAAwB,CAAxB,CAAhB;AACA,UAAIC,gBAAgB,+BAA6BF,SAAjD;AACA,UAAIG,aAAa,4BAA0BH,SAA1B,GAAoC,oBAArD;AACA,UAAII,OAAOrD,IAAI8C,IAAJ,CAASO,IAApB;AACA,UAAIlC,SAAS,CAAb;AACA,UAAIhB,QAAQH,IAAI8C,IAAJ,CAAS3C,KAArB;;AAEAN,gBAAUW,gBAAV,CAA2BL,KAA3B,EAAiCF,GAAjC,EAAqC,UAASQ,MAAT,EAAgB;;AAEnD,YAAIC,SAASD,OAAOC,MAApB;;AAEAjB,mBAAWoB,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,cAAID,GAAJ,EAAS,MAAMA,GAAN;;AAET,cAAIE,MAAM,2CAAyCiC,SAAzC,GAAmD;kCAAnD,GACeJ,WADf,GAC2B,2BAD3B,GACuDA,WADvD,GACmE;oCADnE,GAEiBM,aAFjB,GAE+B,2BAF/B,GAE2DC,UAF3D,GAEsE,oBAFtE,GAE2FL,KAF3F,GAEiG,mBAFjG,GAEqHM,IAFrH,GAE0H,mBAF1H,GAE8IL,IAF9I,GAEmJ;kDAFnJ,GAG+BP,OAH/B,GAGuC,mBAHvC,GAG2D/B,MAH3D,GAGkE,GAH5E;;AAOAK,cAAIX,KAAJ,CAAUY,GAAV,EAAe,UAASF,GAAT,EAAaG,IAAb,EAAkB;AAC/BF,gBAAIG,OAAJ;AACA,gBAAGJ,GAAH,EACI,OAAOb,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASR,IAAIS,IAA7B,EAArB,CAAP;;AAGJ,mBAAOtB,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACJC,0BAAW,GADP;AAEJkB,uBAAQ,IAFJ;AAGJtB,oBAAK,EAAC,WAAUwB,OAAX;AAHD,aAArB,CAAP;AAMD,WAZD;AAaD,SAvBD;AAwBD,OA5BD;AA8BD,KA3CD,CA2CE,OAAO3B,GAAP,EAAW;AACX,aAAOb,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,+CAAzB,EAArB,CAAP;AACD;AACF,GA/CD;;AAiDA,OAAKoC,MAAL,GAAc,UAAS1D,GAAT,EAAaC,GAAb,EAAiBC,IAAjB,EAAuB;AACnC,QAAIuC,UAAUzC,IAAI8C,IAAJ,CAASL,OAAvB;AACA,QAAItC,QAAQH,IAAI8C,IAAJ,CAAS3C,KAArB;;AAEAN,cAAUW,gBAAV,CAA2BL,KAA3B,EAAiCF,GAAjC,EAAqC,UAASQ,MAAT,EAAgB;;AAEnD,UAAIC,SAASD,OAAOC,MAApB;;AAEAjB,iBAAWoB,OAAX,CAAmB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,YAAID,GAAJ,EAAS,MAAMA,GAAN;;AAET,YAAIE,MAAM;gDAAA,GAC+ByB,OAD/B,GACuC,mBADvC,GAC2D/B,MAD3D,GACkE,GAD5E;;AAGA;;;AAIAK,YAAIX,KAAJ,CAAUY,GAAV,EAAe,UAASF,GAAT,EAAaG,IAAb,EAAkB;AAC/BF,cAAIG,OAAJ;AACA,cAAGJ,GAAH,EACI,OAAOb,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASR,IAAIS,IAA7B,EAArB,CAAP;;AAEJ,cAAGN,KAAK0C,YAAL,IAAqB,CAAxB,EACE,OAAO1D,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,8CAAzB,EAArB,CAAP;;AAEF,iBAAOrB,IAAIkB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACJC,wBAAW,GADP;AAEJkB,qBAAQ;AAFJ,WAArB,CAAP;AAKD,SAbD;AAcD,OAxBD;AAyBD,KA7BD;AA8BD,GAlCD;AAoCD;AACDqB,OAAOC,OAAP,GAAiB,IAAI/D,MAAJ,EAAjB","file":"video.js","sourcesContent":["var connection = require('../../../config/db');\n\nvar jwt = require('jsonwebtoken'),\n    bcrypt = require('bcrypt'),\n    userModel = require('../models/user');\n \nfunction cVideo() {\n \n  this.list = function(req,res,next) {\n\n    var email = req.query.email;\n    var page = (req.query.page == undefined) ? 1 : req.query.page;\n    var limit = (req.query.limit == undefined) ? 20 : req.query.limit;\n    \n    userModel.getUserIdByEmail(email,res,function(result){\n      \n      var userId = result.userId;\n      var offset = (page - 1) * limit;\n      var count = \" LIMIT \"+offset+\",\"+limit;\n\n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = \"SELECT v.*, u.user_firstname, u.user_lastname from videos v LEFT JOIN \\\n          users u ON v.user_id = u.user_id WHERE v.status = 1 AND u.user_id = '\"+userId+\"' ORDER BY video_id DESC \"+count\n          \n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n               \n\n            var dt = [];\n            for (var i = 0; i < data.length; i++) {\n                dt.push({\n                  \"videoId\": data[i].video_id,\n                  \"youtubeId\": data[i].video_youtube_id,\n                  \"youtubeLink\": data[i].video_youtube_link,\n                  \"youtubeIframe\": data[i].video_youtube_iframe,\n                  \"youtubeImg\": data[i].video_youtube_image,\n                  \"title\": data[i].video_title,\n                  \"description\": data[i].video_desc,\n                  \"type\": data[i].video_type,\n                  \"author\": data[i].user_firstname+' '+data[i].user_lastname,\n                  \"postDate\": data[i].post_date\n                });\n            }\n\n            return res.status(200).json({\n                                    statusCode:200,\n                                    success:true,\n                                    data:dt\n                                });\n   \n        });\n      });\n\n    });\n  }\n\n  this.detail = function(req,res,next) {\n\n      var videoId = req.params.id;\n    \n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n          var sql = \"SELECT v.*, u.user_firstname, u.user_lastname from videos v LEFT JOIN \\\n          users u ON v.user_id = u.user_id WHERE v.status = 1 AND v.video_id = '\"+videoId+\"' LIMIT 1\";\n          \n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1){\n              res.status(404).json({statusCode:404,message: \"Data not found\"});\n            }else{\n              var dt = [];\n              dt.push({\n                \"videoId\": data[0].video_id,\n                \"youtubeId\": data[0].video_youtube_id,\n                \"youtubeLink\": data[0].video_youtube_link,\n                \"youtubeIframe\": data[0].video_youtube_iframe,\n                \"youtubeImg\": data[0].video_youtube_image,\n                \"title\": data[0].video_title,\n                \"description\": data[0].video_desc,\n                \"type\": data[0].video_type,\n                \"author\": data[0].user_firstname+' '+data[0].user_lastname,\n                \"postDate\": data[0].post_date\n              });\n\n              return res.status(200).json({\n                                      statusCode:200,\n                                      success:true,\n                                      data:dt[0]\n                                  });\n            }\n        });\n      });\n  };\n\n  this.post = function(req,res,next) {\n\n    try {\n\n      var youtubeLink = req.body.youtubeLink;\n      var title = req.body.title;\n      var desc = req.body.desc;\n      var youtubeId = youtubeLink.split(\"v=\")[1];\n      var youtubeIframe = \"https://youtube.com/embed/\"+youtubeId;\n      var youtubeImg = \"https://i.ytimg.com/vi/\"+youtubeId+\"/maxresdefault.jpg\";\n      var type = req.body.type;\n      var status = 1;\n      var email = req.body.email;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n        \n        var userId = result.userId;\n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n\n            var sql = \"INSERT INTO videos (user_id, video_youtube_id, video_youtube_link, video_youtube_iframe \\\n            ,video_youtube_image,video_title,video_desc,video_type,status,post_date) \\\n            VALUES ('\"+userId+\"','\"+youtubeId+\"','\"+youtubeLink+\"','\"+youtubeIframe+\"','\"+youtubeImg+\"','\"+title+\"', '\"+desc+\"', '\"+type+\"', '\"+status+\"', NOW())\";\n\n            console.log(sql);\n\n            con.query(sql, function(err,data){\n              con.release();\n              if(err)\n                  return res.status(500).json({statusCode:500,message: err.code});\n                 \n\n              return res.status(200).json({\n                                      statusCode:200,\n                                      success:true,\n                                      data:{\"videoId\":data.insertId}\n                                  });\n     \n          });\n        });\n      });\n    } catch (err){\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"});\n    }\n    \n     \n  };\n\n  this.update = function(req,res,next) {\n    try {\n\n      var videoId = req.body.videoId;\n      var youtubeLink = req.body.youtubeLink;\n      var title = req.body.title;\n      var desc = req.body.desc;\n      var youtubeId = youtubeLink.split(\"v=\")[1];\n      var youtubeIframe = \"https://youtube.com/embed/\"+youtubeId;\n      var youtubeImg = \"https://i.ytimg.com/vi/\"+youtubeId+\"/maxresdefault.jpg\";\n      var type = req.body.type;\n      var status = 1;\n      var email = req.body.email;\n\n      userModel.getUserIdByEmail(email,res,function(result){\n        \n        var userId = result.userId;\n\n        connection.acquire(function(err,con){\n          if (err) throw err;\n\n          var sql = \"UPDATE videos SET video_youtube_id = '\"+youtubeId+\"' \\\n          ,video_youtube_link = '\"+youtubeLink+\"', video_youtube_link = '\"+youtubeLink+\"' \\\n          ,video_youtube_iframe = '\"+youtubeIframe+\"',video_youtube_image = '\"+youtubeImg+\"', video_title = '\"+title+\"', video_type = '\"+type+\"', video_desc = '\"+desc+\"' \\\n          ,update_date = NOW() WHERE video_id = '\"+videoId+\"' AND user_id = '\"+userId+\"'\";\n\n            \n\n          con.query(sql, function(err,data){\n            con.release();\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n               \n\n            return res.status(200).json({\n                                    statusCode:200,\n                                    success:true,\n                                    data:{\"videoId\":videoId}\n                                });\n     \n          });\n        });\n      });\n\n    } catch (err){\n      return res.status(500).json({statusCode:500,message: \"Please check your parameter or value required\"});\n    }\n  };\n\n  this.delete = function(req,res,next) {\n    var videoId = req.body.videoId;\n    var email = req.body.email;\n\n    userModel.getUserIdByEmail(email,res,function(result){\n      \n      var userId = result.userId;\n\n      connection.acquire(function(err,con){\n        if (err) throw err;\n\n        var sql = \"UPDATE videos SET status = 0 \\\n        ,update_date = NOW() WHERE video_id = '\"+videoId+\"' AND user_id = '\"+userId+\"'\";\n\n        //console.log(sql);\n\n          \n\n        con.query(sql, function(err,data){\n          con.release();\n          if(err)\n              return res.status(500).json({statusCode:500,message: err.code});\n\n          if(data.affectedRows == 0)\n            return res.status(500).json({statusCode:500,message: \"Failed to delete data. Check your parameter.\"}); \n\n          return res.status(200).json({\n                                  statusCode:200,\n                                  success:true\n                              });\n   \n        });\n      });\n    });\n  };\n\n}\nmodule.exports = new cVideo();"]}