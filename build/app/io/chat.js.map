{"version":3,"sources":["../src/app/io/chat.js"],"names":["empty","require","axios","cfg","module","exports","io","app","http","socket","socketUserId","request","_query","room","join","on","data","get","localhost","email","then","response","success","emit","catch","error","post","transactTime","sender","sockets","to","message","dt","firstName","lastName","initialName","photoUrl","from","receiver"],"mappings":"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","file":"chat.js","sourcesContent":["var empty = require('is-empty');\nconst axios = require('axios');\nvar cfg = require('../../../config');\n\nmodule.exports.io \t= function (app, io, http, socket) {\n\n\tlet socketUserId = socket.request._query['userId'];\n\tsocket.room \t= socketUserId;\n\tsocket.join(socket.room); // create socket room ID.\n\n\tsocket.on('chatList', function (data) {\n\n\t\taxios.get(cfg.localhost+'chat/list?email='+data.email)\n\t\t\t.then(response => {\n\t\t\t\t\n\t\t\t\tif(response.data.success){\n\t\t\t\t\t//console.log('get chatlist success');\n\t\t\t\t\t//console.log(response.data);\n\t\t\t\t\tsocket.emit('chatListResponse', response.data);\n\t\t\t\t}\n\n\t\t\t}).catch(error => {\n\t\t    \tsocket.emit('errors','get chat list failed');\n\t\t    });\t\n\t});\n\n\tsocket.on('sendChat', function (data) {\n\n\t\taxios.post(cfg.localhost+'chat/send', data)\n\t\t  .then(function (response) {\n\t\t    \n\t\t    if(response.data.success){\n\t\t    \tvar transactTime = response.data.data.transactTime;\n\t\t    \taxios.get(cfg.localhost+'chat/list?email='+data.sender)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(response.data.success){\n\t\t\t\t\t\t\tio.sockets.to(data.sender).emit('chatListResponse',response.data);\n\t\t\t\t\t\t\tvar message = data.message;\n\n\t\t\t\t\t\t\taxios.get(cfg.localhost+'chat/user-info?email='+data.sender)\n\t\t\t\t\t\t\t\t.then(response => {\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(response.data.success){\n\t\t\t\t\t\t\t\t\t\t//console.log(response.data);\n\t\t\t\t\t\t\t\t\t\tvar dt = {\n\t\t\t\t\t\t\t\t\t\t\temail: response.data.data.email,\n\t\t\t\t\t\t\t\t\t\t\tfirstName: response.data.data.firstName,\n\t\t\t\t\t\t\t\t\t\t\tlastName: response.data.data.lastName,\n\t\t\t\t\t\t\t\t\t\t\tinitialName: response.data.data.initialName,\n\t\t\t\t\t\t\t\t\t\t\tphotoUrl: response.data.data.photoUrl,\n\t\t\t\t\t\t\t\t\t\t\tfrom: data.sender,\n\t\t\t\t\t\t\t\t\t\t\tto: data.receiver,\n\t\t\t\t\t\t\t\t\t\t\tmessage: message,\n\t\t\t\t\t\t\t\t\t\t\ttransactTime: transactTime\n\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\tio.sockets.to(data.sender).emit('newChat',dt);\n\t\t\t\t\t\t\t\t\t\tio.sockets.to(data.receiver).emit('newChat',dt);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t    \tio.sockets.to(data.sender).emit('errors','get chat list failed');\n\t\t\t\t\t\t\t    });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t    \tio.sockets.to(data.sender).emit('errors','get chat list failed');\n\t\t\t\t    });\n\n\t\t\t\taxios.get(cfg.localhost+'chat/list?email='+data.receiver)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(response.data.success){\n\t\t\t\t\t\t\tio.sockets.to(data.receiver).emit('chatListResponse',response.data);\n\t\t\t\t\t\t\tvar message = data.message;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t    \tio.sockets.to(data.receiver).emit('errors','get chat list failed');\n\t\t\t\t    });\t\t\n\n\t\t    }\n\n\t\t  })\n\t\t  .catch(function (error) {\n\t\t    socket.emit('errors','get chat list failed');\n\t\t  });\n\t\t\t\n\t});\n\n}"]}