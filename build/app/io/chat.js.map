{"version":3,"sources":["../src/app/io/chat.js"],"names":["empty","require","axios","cfg","module","exports","io","app","http","socket","socketUserId","request","_query","room","join","on","data","get","localhost","email","then","response","success","emit","catch","error","post","replyId","transactTime","sender","sockets","to","message","dt","firstName","lastName","initialName","photoUrl","from","receiver"],"mappings":"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","file":"chat.js","sourcesContent":["var empty = require('is-empty');\nconst axios = require('axios');\nvar cfg = require('../../../config');\n\nmodule.exports.io \t= function (app, io, http, socket) {\n\n\tlet socketUserId = socket.request._query['userId'];\n\tsocket.room \t= socketUserId;\n\tsocket.join(socket.room); // create socket room ID.\n\n\tsocket.on('chatList', function (data) {\n\t\taxios.get(cfg.localhost+'chat/list?email='+data.email)\n\t\t\t.then(response => {\n\t\t\t\t\n\t\t\t\tif(response.data.success){\n\t\t\t\t\t//console.log('get chatlist success');\n\t\t\t\t\t//console.log(response.data);\n\t\t\t\t\tsocket.emit('chatListResponse', response.data);\n\t\t\t\t}\n\n\t\t\t}).catch(error => {\n\t\t    \tsocket.emit('errors','get chat list failed');\n\t\t    });\t\n\t});\n\n\tsocket.on('sendChat', function (data) {\n\n\t\taxios.post(cfg.localhost+'chat/send', data)\n\t\t  .then(function (response) {\n\t\t    \n\t\t    if(response.data.success){\n\t\t    \tvar replyId = response.data.data.replyId;\n\t\t    \tvar transactTime = response.data.data.transactTime;\n\t\t    \taxios.get(cfg.localhost+'chat/list?email='+data.sender)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(response.data.success){\n\t\t\t\t\t\t\tio.sockets.to(data.sender).emit('chatListResponse',response.data);\n\t\t\t\t\t\t\tvar message = data.message;\n\n\t\t\t\t\t\t\taxios.get(cfg.localhost+'chat/user-info?email='+data.sender)\n\t\t\t\t\t\t\t\t.then(response => {\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(response.data.success){\n\t\t\t\t\t\t\t\t\t\t//console.log(response.data);\n\t\t\t\t\t\t\t\t\t\tvar dt = {\n\t\t\t\t\t\t\t\t\t\t\treplyId: replyId,\n\t\t\t\t\t\t\t\t\t\t\temail: response.data.data.email,\n\t\t\t\t\t\t\t\t\t\t\tfirstName: response.data.data.firstName,\n\t\t\t\t\t\t\t\t\t\t\tlastName: response.data.data.lastName,\n\t\t\t\t\t\t\t\t\t\t\tinitialName: response.data.data.initialName,\n\t\t\t\t\t\t\t\t\t\t\tphotoUrl: response.data.data.photoUrl,\n\t\t\t\t\t\t\t\t\t\t\tfrom: data.sender,\n\t\t\t\t\t\t\t\t\t\t\tto: data.receiver,\n\t\t\t\t\t\t\t\t\t\t\tmessage: message,\n\t\t\t\t\t\t\t\t\t\t\ttransactTime: transactTime\n\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\tio.sockets.to(data.sender).emit('newChat',dt);\n\t\t\t\t\t\t\t\t\t\tio.sockets.to(data.receiver).emit('newChat',dt);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t    \tio.sockets.to(data.sender).emit('errors','get chat list failed');\n\t\t\t\t\t\t\t    });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t    \tio.sockets.to(data.sender).emit('errors','get chat list failed');\n\t\t\t\t    });\n\n\t\t\t\taxios.get(cfg.localhost+'chat/list?email='+data.receiver)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(response.data.success){\n\t\t\t\t\t\t\tio.sockets.to(data.receiver).emit('chatListResponse',response.data);\n\t\t\t\t\t\t\tvar message = data.message;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t    \tio.sockets.to(data.receiver).emit('errors','get chat list failed');\n\t\t\t\t    });\t\t\n\n\t\t    }\n\n\t\t  })\n\t\t  .catch(function (error) {\n\t\t    socket.emit('errors','get chat list failed');\n\t\t  });\n\t\t\t\n\t});\n\n}\n"]}