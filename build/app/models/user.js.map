{"version":3,"sources":["../src/app/models/user.js"],"names":["bcrypt","require","connection","methods","comparePassword","password","hash_password","compareSync","getUserIdByEmail","con","email","res","callback","console","log","query","err","data","fields","status","json","statusCode","message","code","length","user_id","getReferalCodeByEmail","user_username","checkEmailExist","checkUsernameExist","username","checkUsernameCompareExist","oldUsername","checkUserReferalCode","referalCode","sql","inviterId","user_invited_by","userName","user_firstname","user_lastname","userEmail","user_email","userId","sql2","inviterName","inviterEmail","updatePoint","point","updatePointByEmail","test","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["'use strict';\n\nvar bcrypt = require('bcrypt');\nvar connection = require('../../../config/db');\n\nvar methods = {\n\t\n\tcomparePassword: function(password, hash_password) {\n\t\treturn bcrypt.compareSync(password, hash_password);\n\t},\n\tgetUserIdByEmail: function(con,email,res,callback){\n        console.log(email);\n\n        if(email == \"root\"){\n            callback({\"userId\":\"root\"});    \n        }else{\n            con.query('SELECT user_id FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n                if(err)\n                    return res.status(500).json({statusCode:500,message: err.code});\n\n                if(callback){\n\n                    if(data.length < 1){\n                        return res.status(500).json({statusCode:500,message: \"Either data user or data inviter not found\"});\n                    }else{\n                        callback({\"userId\":data[0].user_id});\n                    }\n                }\n\n            });\n        }\n\t},\n\tgetReferalCodeByEmail: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_id, user_username FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n\n        \t\tif(data.length < 1){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Referal code not found\"});\n        \t\t}else{\n        \t\t\t//var referalCode = email.split(\"@\");\n        \t\t\t//referalCode = referalCode[0];\n          \t\t\t//callback({\"referalCode\":referalCode+''+data[0].user_id});\n                    callback({\"referalCode\":data[0].user_username});\n          \t\t}\n        \t}\n\n\t\t});\n\t},\n\tcheckEmailExist: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_email FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n        \t\tif(data.length > 0){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Email has been registered\"});\n        \t\t}else{\n        \t\t\tcallback(true);\n        \t\t}\n\n        \t}\n\t\t});\n     \t\n\t},\n    checkUsernameExist: function(con,username,res,callback){\n\n        con.query('SELECT user_username FROM users WHERE user_username = \"'+username+'\" LIMIT 1', function (err, data, fields){\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(callback){\n                if(data.length > 0){\n                    return res.status(500).json({statusCode:500,message: \"Username has been registered\"});\n                }else{\n                    callback(true);\n                }\n\n            }\n        });\n        \n    },\n    checkUsernameCompareExist: function(con,username,oldUsername,res,callback){\n\n        if(username != oldUsername){\n            con.query('SELECT user_username FROM users WHERE user_username = \"'+username+'\" LIMIT 1', function (err, data, fields){\n                if(err)\n                    return res.status(500).json({statusCode:500,message: err.code});\n\n                if(callback){\n                    if(data.length > 0){\n                        return res.status(500).json({statusCode:500,message: \"Username has been registered\"});\n                    }else{\n                        callback(true);\n                    }\n\n                }\n            });\n        }else{\n            callback(true);   \n        }\n        \n    },\n\tcheckUserReferalCode: function(con,email,referalCode,res,callback){\n\n\t\tvar sql = \"SELECT user_id, user_email, user_firstname, user_lastname, user_invited_by FROM users WHERE user_email = '\"+email+\"' AND user_referal_code = '\"+referalCode+\"' LIMIT 1\";\n\t\n\t\tcon.query(sql, function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1)\n                return res.status(500).json({statusCode:500,message: \"Inviter not found\"});\n\n        \tvar inviterId = data[0].user_invited_by;\n        \tvar userName = data[0].user_firstname+' '+data[0].user_lastname;\n        \tvar userEmail = data[0].user_email;\n        \tvar userId = data[0].user_id;\n\n        \tvar sql2 = \"SELECT user_email, user_firstname, user_lastname FROM users WHERE user_id = '\"+inviterId+\"' LIMIT 1\";\n\n        \tcon.query(sql2, function (err, data, fields){\n        \t\tif(err)\n        \t\t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \t\tvar inviterName = data[0].user_firstname+' '+data[0].user_lastname;\n        \t\tvar inviterEmail = data[0].user_email\n\n        \t\tif(callback){\n            \t\tif(data.length < 1){\n              \t\t\treturn res.status(500).json({statusCode:500,message: \"Email or Referal Code not found\"});\n            \t\t}else{\n            \t\t\tcallback({\n            \t\t\t\t\"inviterId\":inviterId,\n            \t\t\t\t\"userId\":userId,\n            \t\t\t\t\"userName\":userName,\n            \t\t\t\t\"userEmail\":userEmail,\n            \t\t\t\t\"inviterName\":inviterName,\n            \t\t\t\t\"inviterEmail\":inviterEmail\n            \t\t\t});\n            \t\t}\n\n            \t}\n        \t});\n\n        \t\n\t\t});\n\t},\n\tupdatePoint: function(con,userId,point,res,callback){\n\n\t\tvar sql = \"update users set user_point = user_point+\"+point+\", update_date = NOW() WHERE user_id = '\"+userId+\"'\";\n\t\n\t\tcon.query(sql, function (err, data){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n        \t\tcallback(true);\n        \t}\n\t\t});\n     \t\n\t},\n    updatePointByEmail: function(con,email,point,res,callback){\n\n        var sql = \"update users set user_point = user_point+\"+point+\", update_date = NOW() WHERE user_email = '\"+email+\"'\";\n    \n        con.query(sql, function (err, data){\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(callback){\n                callback(true);\n            }\n        });\n        \n    },\n\ttest: function(){\n\t\treturn 'bcd';\n\t}\n};\n\nmodule.exports = methods;"]}