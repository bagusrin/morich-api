{"version":3,"sources":["../src/app/models/user.js"],"names":["bcrypt","require","connection","methods","comparePassword","password","hash_password","compareSync","getUserIdByEmail","email","res","callback","acquire","err","con","release","query","data","fields","status","json","statusCode","message","code","length","user_id","getReferalCodeByEmail","referalCode","split","checkEmailExist","checkUserReferalCode","sql","inviterId","user_invited_by","userName","user_firstname","user_lastname","userEmail","user_email","userId","sql2","inviterName","inviterEmail","updatePoint","point","getUserFullByEmail","test","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["'use strict';\n\nvar bcrypt = require('bcrypt');\nvar connection = require('../../../config/db');\n\nvar methods = {\n\t\n\tcomparePassword: function(password, hash_password) {\n\t\treturn bcrypt.compareSync(password, hash_password);\n\t},\n\tgetUserIdByEmail: function(email,res,callback){\n\n\t\tconnection.acquire(function(err,con){\n            con.release();\n        \n        \tif (err) throw err;\n        \t\n        \t\tcon.query('SELECT user_id FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n            \t\tcon.release();\n            \t\tif(err)\n                \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n                \tif(callback){\n\n                \t\tif(data.length < 1){\n\t              \t\t\treturn res.status(500).json({statusCode:500,message: \"Either data user or data inviter not found\"});\n\t            \t\t}else{\n\t              \t\t\tcallback({\"userId\":data[0].user_id});\n\t              \t\t}\n                \t}\n\n        \t\t});\n     \t});\n\t},\n\tgetReferalCodeByEmail: function(email,res,callback){\n\n\t\tconnection.acquire(function(err,con){\n        \n        \tif (err) throw err;\n        \t\n        \t\tcon.query('SELECT user_id FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n            \t\tcon.release();\n            \t\tif(err)\n                \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n                \tif(callback){\n\n                \t\tif(data.length < 1){\n\t              \t\t\treturn res.status(500).json({statusCode:500,message: \"Referal code not found\"});\n\t            \t\t}else{\n\t            \t\t\tvar referalCode = email.split(\"@\");\n\t            \t\t\treferalCode = referalCode[0];\n\t              \t\t\tcallback({\"referalCode\":referalCode+''+data[0].user_id});\n\t              \t\t}\n                \t}\n\n        \t\t});\n     \t});\n\t},\n\tcheckEmailExist: function(email,res,callback){\n\n\t\tconnection.acquire(function(err,con){\n        \n        \tif (err) throw err;\n        \t\n        \t\tcon.query('SELECT user_email FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n            \t\tcon.release();\n            \t\tif(err)\n                \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n                \tif(callback){\n                \t\tif(data.length > 0){\n\t              \t\t\treturn res.status(500).json({statusCode:500,message: \"Email has been registered\"});\n                \t\t}else{\n                \t\t\tcallback(true);\n                \t\t}\n\n                \t}\n        \t\t});\n     \t});\n\t},\n\tcheckUserReferalCode: function(email,referalCode,res,callback){\n\n\t\tconnection.acquire(function(err,con){\n        \n        \tif (err) throw err;\n\n        \t\tvar sql = \"SELECT user_id, user_email, user_firstname, user_lastname, user_invited_by FROM users WHERE user_email = '\"+email+\"' AND user_referal_code = '\"+referalCode+\"' LIMIT 1\";\n        \t\n        \t\tcon.query(sql, function (err, data, fields){\n            \t\tcon.release();\n            \t\tif(err)\n                \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n                \tvar inviterId = data[0].user_invited_by;\n                \tvar userName = data[0].user_firstname+' '+data[0].user_lastname;\n                \tvar userEmail = data[0].user_email;\n                \tvar userId = data[0].user_id;\n\n                \tvar sql2 = \"SELECT user_email, user_firstname, user_lastname FROM users WHERE user_id = '\"+inviterId+\"' LIMIT 1\";\n\n                \tcon.query(sql2, function (err, data, fields){\n                \t\tif(err)\n                \t\t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n                \t\tvar inviterName = data[0].user_firstname+' '+data[0].user_lastname;\n                \t\tvar inviterEmail = data[0].user_email\n\n                \t\tif(callback){\n\t                \t\tif(data.length < 1){\n\t\t              \t\t\treturn res.status(500).json({statusCode:500,message: \"Email or Referal Code not found\"});\n\t                \t\t}else{\n\t                \t\t\tcallback({\n\t                \t\t\t\t\"inviterId\":inviterId,\n\t                \t\t\t\t\"userId\":userId,\n\t                \t\t\t\t\"userName\":userName,\n\t                \t\t\t\t\"userEmail\":userEmail,\n\t                \t\t\t\t\"inviterName\":inviterName,\n\t                \t\t\t\t\"inviterEmail\":inviterEmail\n\t                \t\t\t});\n\t                \t\t}\n\n\t                \t}\n                \t});\n\n                \t\n        \t\t});\n     \t});\n\t},\n\tupdatePoint: function(userId,point,res,callback){\n\n\t\tconnection.acquire(function(err,con){\n        \n        \tif (err) throw err;\n\n        \t\tvar sql = \"update users set user_point = user_point+\"+point+\", update_date = NOW() WHERE user_id = '\"+userId+\"'\";\n\n                //console.log(sql);\n        \t\n        \t\tcon.query(sql, function (err, data){\n            \t\tcon.release();\n            \t\tif(err)\n                \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n                \tif(callback){\n                \t\tcallback(true);\n                \t}\n        \t\t});\n     \t});\n\t},\n\tgetUserFullByEmail: function(email,res,callback){\n\n\t\tconnection.acquire(function(err,con){\n        \n        \tif (err) throw err;\n\n        \t\tvar sql = \"SELECT * FROM users WHERE user_email = '\"+email+\"' LIMIT 1\";\n        \t\n        \t\tcon.query(sql, function (err, data, fields){\n            \t\tcon.release();\n            \t\tif(err)\n                \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n                \tif(callback){\n                \t\tif(data.length < 1){\n\t              \t\t\treturn res.status(500).json({statusCode:500,message: \"Data not found\"});\n                \t\t}else{\n                \t\t\tcallback(data);\n                \t\t}\n\n                \t}\n        \t\t});\n     \t});\n\t},\n\ttest: function(){\n\t\treturn 'bcd';\n\t}\n};\n\nmodule.exports = methods;"]}