{"version":3,"sources":["../src/app/models/user.js"],"names":["bcrypt","require","connection","methods","comparePassword","password","hash_password","compareSync","getUserIdByEmail","con","email","res","callback","query","err","data","fields","status","json","statusCode","message","code","length","user_id","getReferalCodeByEmail","user_username","checkEmailExist","checkUserReferalCode","referalCode","sql","inviterId","user_invited_by","userName","user_firstname","user_lastname","userEmail","user_email","userId","sql2","inviterName","inviterEmail","updatePoint","point","test","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["'use strict';\n\nvar bcrypt = require('bcrypt');\nvar connection = require('../../../config/db');\n\nvar methods = {\n\t\n\tcomparePassword: function(password, hash_password) {\n\t\treturn bcrypt.compareSync(password, hash_password);\n\t},\n\tgetUserIdByEmail: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_id FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n\n        \t\tif(data.length < 1){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Either data user or data inviter not found\"});\n        \t\t}else{\n          \t\t\tcallback({\"userId\":data[0].user_id});\n          \t\t}\n        \t}\n\n\t\t});\n\t},\n\tgetReferalCodeByEmail: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_id, user_username FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n\n        \t\tif(data.length < 1){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Referal code not found\"});\n        \t\t}else{\n        \t\t\t//var referalCode = email.split(\"@\");\n        \t\t\t//referalCode = referalCode[0];\n          \t\t\t//callback({\"referalCode\":referalCode+''+data[0].user_id});\n                    callback({\"referalCode\":data[0].user_username});\n          \t\t}\n        \t}\n\n\t\t});\n\t},\n\tcheckEmailExist: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_email FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n        \t\tif(data.length > 0){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Email has been registered\"});\n        \t\t}else{\n        \t\t\tcallback(true);\n        \t\t}\n\n        \t}\n\t\t});\n     \t\n\t},\n\tcheckUserReferalCode: function(con,email,referalCode,res,callback){\n\n\t\tvar sql = \"SELECT user_id, user_email, user_firstname, user_lastname, user_invited_by FROM users WHERE user_email = '\"+email+\"' AND user_referal_code = '\"+referalCode+\"' LIMIT 1\";\n\t\n\t\tcon.query(sql, function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1)\n                return res.status(500).json({statusCode:500,message: \"Inviter not found\"});\n\n        \tvar inviterId = data[0].user_invited_by;\n        \tvar userName = data[0].user_firstname+' '+data[0].user_lastname;\n        \tvar userEmail = data[0].user_email;\n        \tvar userId = data[0].user_id;\n\n        \tvar sql2 = \"SELECT user_email, user_firstname, user_lastname FROM users WHERE user_id = '\"+inviterId+\"' LIMIT 1\";\n\n        \tcon.query(sql2, function (err, data, fields){\n        \t\tif(err)\n        \t\t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \t\tvar inviterName = data[0].user_firstname+' '+data[0].user_lastname;\n        \t\tvar inviterEmail = data[0].user_email\n\n        \t\tif(callback){\n            \t\tif(data.length < 1){\n              \t\t\treturn res.status(500).json({statusCode:500,message: \"Email or Referal Code not found\"});\n            \t\t}else{\n            \t\t\tcallback({\n            \t\t\t\t\"inviterId\":inviterId,\n            \t\t\t\t\"userId\":userId,\n            \t\t\t\t\"userName\":userName,\n            \t\t\t\t\"userEmail\":userEmail,\n            \t\t\t\t\"inviterName\":inviterName,\n            \t\t\t\t\"inviterEmail\":inviterEmail\n            \t\t\t});\n            \t\t}\n\n            \t}\n        \t});\n\n        \t\n\t\t});\n\t},\n\tupdatePoint: function(con,userId,point,res,callback){\n\n\t\tvar sql = \"update users set user_point = user_point+\"+point+\", update_date = NOW() WHERE user_id = '\"+userId+\"'\";\n\t\n\t\tcon.query(sql, function (err, data){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n        \t\tcallback(true);\n        \t}\n\t\t});\n     \t\n\t},\n\ttest: function(){\n\t\treturn 'bcd';\n\t}\n};\n\nmodule.exports = methods;"]}