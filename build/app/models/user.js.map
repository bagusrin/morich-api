{"version":3,"sources":["../src/app/models/user.js"],"names":["bcrypt","require","connection","methods","comparePassword","password","hash_password","compareSync","getUserIdByEmail","con","email","res","callback","query","err","data","fields","status","json","statusCode","message","code","length","user_id","getReferalCodeByEmail","user_username","checkEmailExist","checkUserReferalCode","referalCode","sql","inviterId","user_invited_by","userName","user_firstname","user_lastname","userEmail","user_email","userId","sql2","inviterName","inviterEmail","updatePoint","point","updatePointByEmail","test","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,SAASC,QAAQ,QAAR,CAAb;AACA,IAAIC,aAAaD,QAAQ,oBAAR,CAAjB;;AAEA,IAAIE,UAAU;;AAEbC,qBAAiB,UAASC,QAAT,EAAmBC,aAAnB,EAAkC;AAClD,eAAON,OAAOO,WAAP,CAAmBF,QAAnB,EAA6BC,aAA7B,CAAP;AACA,KAJY;AAKbE,sBAAkB,UAASC,GAAT,EAAaC,KAAb,EAAmBC,GAAnB,EAAuBC,QAAvB,EAAgC;;AAEjDH,YAAII,KAAJ,CAAU,mDAAiDH,KAAjD,GAAuD,WAAjE,EAA8E,UAAUI,GAAV,EAAeC,IAAf,EAAqBC,MAArB,EAA4B;AACtG,gBAAGF,GAAH,EACI,OAAOH,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASN,IAAIO,IAA7B,EAArB,CAAP;;AAED,gBAAGT,QAAH,EAAY;;AAEX,oBAAGG,KAAKO,MAAL,GAAc,CAAjB,EAAmB;AAChB,2BAAOX,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,4CAAzB,EAArB,CAAP;AACF,iBAFD,MAEK;AACFR,6BAAS,EAAC,UAASG,KAAK,CAAL,EAAQQ,OAAlB,EAAT;AACA;AACH;AAEP,SAbD;AAcA,KArBY;AAsBbC,2BAAuB,UAASf,GAAT,EAAaC,KAAb,EAAmBC,GAAnB,EAAuBC,QAAvB,EAAgC;;AAEtDH,YAAII,KAAJ,CAAU,kEAAgEH,KAAhE,GAAsE,WAAhF,EAA6F,UAAUI,GAAV,EAAeC,IAAf,EAAqBC,MAArB,EAA4B;AACrH,gBAAGF,GAAH,EACI,OAAOH,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASN,IAAIO,IAA7B,EAArB,CAAP;;AAED,gBAAGT,QAAH,EAAY;;AAEX,oBAAGG,KAAKO,MAAL,GAAc,CAAjB,EAAmB;AAChB,2BAAOX,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,wBAAzB,EAArB,CAAP;AACF,iBAFD,MAEK;AACJ;AACA;AACE;AACOR,6BAAS,EAAC,eAAcG,KAAK,CAAL,EAAQU,aAAvB,EAAT;AACP;AACH;AAEP,SAhBD;AAiBA,KAzCY;AA0CbC,qBAAiB,UAASjB,GAAT,EAAaC,KAAb,EAAmBC,GAAnB,EAAuBC,QAAvB,EAAgC;;AAEhDH,YAAII,KAAJ,CAAU,sDAAoDH,KAApD,GAA0D,WAApE,EAAiF,UAAUI,GAAV,EAAeC,IAAf,EAAqBC,MAArB,EAA4B;AACzG,gBAAGF,GAAH,EACI,OAAOH,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASN,IAAIO,IAA7B,EAArB,CAAP;;AAED,gBAAGT,QAAH,EAAY;AACX,oBAAGG,KAAKO,MAAL,GAAc,CAAjB,EAAmB;AAChB,2BAAOX,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,2BAAzB,EAArB,CAAP;AACF,iBAFD,MAEK;AACJR,6BAAS,IAAT;AACA;AAED;AACP,SAZD;AAcA,KA1DY;AA2Dbe,0BAAsB,UAASlB,GAAT,EAAaC,KAAb,EAAmBkB,WAAnB,EAA+BjB,GAA/B,EAAmCC,QAAnC,EAA4C;;AAEjE,YAAIiB,MAAM,+GAA6GnB,KAA7G,GAAmH,6BAAnH,GAAiJkB,WAAjJ,GAA6J,WAAvK;;AAEAnB,YAAII,KAAJ,CAAUgB,GAAV,EAAe,UAAUf,GAAV,EAAeC,IAAf,EAAqBC,MAArB,EAA4B;AACvC,gBAAGF,GAAH,EACI,OAAOH,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASN,IAAIO,IAA7B,EAArB,CAAP;;AAEE,gBAAGN,KAAKO,MAAL,GAAc,CAAjB,EACI,OAAOX,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,mBAAzB,EAArB,CAAP;;AAEP,gBAAIU,YAAYf,KAAK,CAAL,EAAQgB,eAAxB;AACA,gBAAIC,WAAWjB,KAAK,CAAL,EAAQkB,cAAR,GAAuB,GAAvB,GAA2BlB,KAAK,CAAL,EAAQmB,aAAlD;AACA,gBAAIC,YAAYpB,KAAK,CAAL,EAAQqB,UAAxB;AACA,gBAAIC,SAAStB,KAAK,CAAL,EAAQQ,OAArB;;AAEA,gBAAIe,OAAO,kFAAgFR,SAAhF,GAA0F,WAArG;;AAEArB,gBAAII,KAAJ,CAAUyB,IAAV,EAAgB,UAAUxB,GAAV,EAAeC,IAAf,EAAqBC,MAArB,EAA4B;AAC3C,oBAAGF,GAAH,EACC,OAAOH,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASN,IAAIO,IAA7B,EAArB,CAAP;;AAED,oBAAIkB,cAAcxB,KAAK,CAAL,EAAQkB,cAAR,GAAuB,GAAvB,GAA2BlB,KAAK,CAAL,EAAQmB,aAArD;AACA,oBAAIM,eAAezB,KAAK,CAAL,EAAQqB,UAA3B;;AAEA,oBAAGxB,QAAH,EAAY;AACR,wBAAGG,KAAKO,MAAL,GAAc,CAAjB,EAAmB;AAChB,+BAAOX,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAAS,iCAAzB,EAArB,CAAP;AACF,qBAFD,MAEK;AACJR,iCAAS;AACR,yCAAYkB,SADJ;AAER,sCAASO,MAFD;AAGR,wCAAWL,QAHH;AAIR,yCAAYG,SAJJ;AAKR,2CAAcI,WALN;AAMR,4CAAeC;AANP,yBAAT;AAQA;AAED;AACJ,aAtBD;AAyBN,SAvCD;AAwCA,KAvGY;AAwGbC,iBAAa,UAAShC,GAAT,EAAa4B,MAAb,EAAoBK,KAApB,EAA0B/B,GAA1B,EAA8BC,QAA9B,EAAuC;;AAEnD,YAAIiB,MAAM,8CAA4Ca,KAA5C,GAAkD,yCAAlD,GAA4FL,MAA5F,GAAmG,GAA7G;;AAEA5B,YAAII,KAAJ,CAAUgB,GAAV,EAAe,UAAUf,GAAV,EAAeC,IAAf,EAAoB;AAC/B,gBAAGD,GAAH,EACI,OAAOH,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASN,IAAIO,IAA7B,EAArB,CAAP;;AAED,gBAAGT,QAAH,EAAY;AACXA,yBAAS,IAAT;AACA;AACP,SAPD;AASA,KArHY;AAsHV+B,wBAAoB,UAASlC,GAAT,EAAaC,KAAb,EAAmBgC,KAAnB,EAAyB/B,GAAzB,EAA6BC,QAA7B,EAAsC;;AAEtD,YAAIiB,MAAM,8CAA4Ca,KAA5C,GAAkD,4CAAlD,GAA+FhC,KAA/F,GAAqG,GAA/G;;AAEAD,YAAII,KAAJ,CAAUgB,GAAV,EAAe,UAAUf,GAAV,EAAeC,IAAf,EAAoB;AAC/B,gBAAGD,GAAH,EACI,OAAOH,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,YAAW,GAAZ,EAAgBC,SAASN,IAAIO,IAA7B,EAArB,CAAP;;AAEJ,gBAAGT,QAAH,EAAY;AACRA,yBAAS,IAAT;AACH;AACJ,SAPD;AASH,KAnIS;AAoIbgC,UAAM,YAAU;AACf,eAAO,KAAP;AACA;AAtIY,CAAd;;AAyIAC,OAAOC,OAAP,GAAiB3C,OAAjB","file":"user.js","sourcesContent":["'use strict';\n\nvar bcrypt = require('bcrypt');\nvar connection = require('../../../config/db');\n\nvar methods = {\n\t\n\tcomparePassword: function(password, hash_password) {\n\t\treturn bcrypt.compareSync(password, hash_password);\n\t},\n\tgetUserIdByEmail: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_id FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n\n        \t\tif(data.length < 1){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Either data user or data inviter not found\"});\n        \t\t}else{\n          \t\t\tcallback({\"userId\":data[0].user_id});\n          \t\t}\n        \t}\n\n\t\t});\n\t},\n\tgetReferalCodeByEmail: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_id, user_username FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n\n        \t\tif(data.length < 1){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Referal code not found\"});\n        \t\t}else{\n        \t\t\t//var referalCode = email.split(\"@\");\n        \t\t\t//referalCode = referalCode[0];\n          \t\t\t//callback({\"referalCode\":referalCode+''+data[0].user_id});\n                    callback({\"referalCode\":data[0].user_username});\n          \t\t}\n        \t}\n\n\t\t});\n\t},\n\tcheckEmailExist: function(con,email,res,callback){\n\n\t\tcon.query('SELECT user_email FROM users WHERE user_email = \"'+email+'\" LIMIT 1', function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n        \t\tif(data.length > 0){\n          \t\t\treturn res.status(500).json({statusCode:500,message: \"Email has been registered\"});\n        \t\t}else{\n        \t\t\tcallback(true);\n        \t\t}\n\n        \t}\n\t\t});\n     \t\n\t},\n\tcheckUserReferalCode: function(con,email,referalCode,res,callback){\n\n\t\tvar sql = \"SELECT user_id, user_email, user_firstname, user_lastname, user_invited_by FROM users WHERE user_email = '\"+email+\"' AND user_referal_code = '\"+referalCode+\"' LIMIT 1\";\n\t\n\t\tcon.query(sql, function (err, data, fields){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n            if(data.length < 1)\n                return res.status(500).json({statusCode:500,message: \"Inviter not found\"});\n\n        \tvar inviterId = data[0].user_invited_by;\n        \tvar userName = data[0].user_firstname+' '+data[0].user_lastname;\n        \tvar userEmail = data[0].user_email;\n        \tvar userId = data[0].user_id;\n\n        \tvar sql2 = \"SELECT user_email, user_firstname, user_lastname FROM users WHERE user_id = '\"+inviterId+\"' LIMIT 1\";\n\n        \tcon.query(sql2, function (err, data, fields){\n        \t\tif(err)\n        \t\t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \t\tvar inviterName = data[0].user_firstname+' '+data[0].user_lastname;\n        \t\tvar inviterEmail = data[0].user_email\n\n        \t\tif(callback){\n            \t\tif(data.length < 1){\n              \t\t\treturn res.status(500).json({statusCode:500,message: \"Email or Referal Code not found\"});\n            \t\t}else{\n            \t\t\tcallback({\n            \t\t\t\t\"inviterId\":inviterId,\n            \t\t\t\t\"userId\":userId,\n            \t\t\t\t\"userName\":userName,\n            \t\t\t\t\"userEmail\":userEmail,\n            \t\t\t\t\"inviterName\":inviterName,\n            \t\t\t\t\"inviterEmail\":inviterEmail\n            \t\t\t});\n            \t\t}\n\n            \t}\n        \t});\n\n        \t\n\t\t});\n\t},\n\tupdatePoint: function(con,userId,point,res,callback){\n\n\t\tvar sql = \"update users set user_point = user_point+\"+point+\", update_date = NOW() WHERE user_id = '\"+userId+\"'\";\n\t\n\t\tcon.query(sql, function (err, data){\n    \t\tif(err)\n        \t\treturn res.status(500).json({statusCode:500,message: err.code});\n\n        \tif(callback){\n        \t\tcallback(true);\n        \t}\n\t\t});\n     \t\n\t},\n    updatePointByEmail: function(con,email,point,res,callback){\n\n        var sql = \"update users set user_point = user_point+\"+point+\", update_date = NOW() WHERE user_email = '\"+email+\"'\";\n    \n        con.query(sql, function (err, data){\n            if(err)\n                return res.status(500).json({statusCode:500,message: err.code});\n\n            if(callback){\n                callback(true);\n            }\n        });\n        \n    },\n\ttest: function(){\n\t\treturn 'bcd';\n\t}\n};\n\nmodule.exports = methods;"]}